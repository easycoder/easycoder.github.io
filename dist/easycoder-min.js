var $jscomp$this=this,$jscomp=$jscomp||{};$jscomp.scope={};$jscomp.createTemplateTagFirstArg=function(a){return a.raw=a};$jscomp.createTemplateTagFirstArgWithRaw=function(a,b){a.raw=b;return a};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};
$jscomp.makeIterator=function(a){var b="undefined"!=typeof Symbol&&Symbol.iterator&&a[Symbol.iterator];return b?b.call(a):$jscomp.arrayIterator(a)};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.polyfill("Object.is",function(a){return a?a:function(b,c){return b===c?0!==b||1/b===1/c:b!==b&&c!==c}},"es6","es3");
$jscomp.polyfill("Array.prototype.includes",function(a){return a?a:function(b,c){var d=this;d instanceof String&&(d=String(d));var e=d.length;c=c||0;for(0>c&&(c=Math.max(c+e,0));c<e;c++){var f=d[c];if(f===b||Object.is(f,b))return!0}return!1}},"es7","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.polyfill("String.prototype.includes",function(a){return a?a:function(b,c){return-1!==$jscomp.checkStringArgs(this,b,"includes").indexOf(b,c||0)}},"es6","es3");
$jscomp.polyfill("Math.trunc",function(a){return a?a:function(b){b=Number(b);if(isNaN(b)||Infinity===b||-Infinity===b||0===b)return b;var c=Math.floor(Math.abs(b));return 0>b?-c:c}},"es6","es3");$jscomp.polyfill("String.prototype.endsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"endsWith");b+="";void 0===c&&(c=d.length);c=Math.max(0,Math.min(c|0,d.length));for(var e=b.length;0<e&&0<c;)if(d[--c]!=b[--e])return!1;return 0>=e}},"es6","es3");
$jscomp.polyfill("String.prototype.startsWith",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,b,"startsWith");b+="";var e=d.length,f=b.length;c=Math.max(0,Math.min(c|0,d.length));for(var g=0;g<f&&c<e;)if(d[c++]!=b[g++])return!1;return g>=f}},"es6","es3");
$jscomp.polyfill("String.prototype.repeat",function(a){return a?a:function(b){var c=$jscomp.checkStringArgs(this,null,"repeat");if(0>b||1342177279<b)throw new RangeError("Invalid count value");b|=0;for(var d="";b;)if(b&1&&(d+=c),b>>>=1)c+=c;return d}},"es6","es3");$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padStart",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,null,"padStart");return $jscomp.stringPadding(c,b-d.length)+d}},"es8","es3");$jscomp.initSymbol=function(){};
$jscomp.polyfill("Symbol",function(a){if(a)return a;var b=function(f,g){this.$jscomp$symbol$id_=f;$jscomp.defineProperty(this,"description",{configurable:!0,writable:!0,value:g})};b.prototype.toString=function(){return this.$jscomp$symbol$id_};var c="jscomp_symbol_"+(1E9*Math.random()>>>0)+"_",d=0,e=function(f){if(this instanceof e)throw new TypeError("Symbol is not a constructor");return new b(c+(f||"")+"_"+d++,f)};return e},"es6","es3");
$jscomp.polyfill("Symbol.iterator",function(a){if(a)return a;a=Symbol("Symbol.iterator");for(var b="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),c=0;c<b.length;c++){var d=$jscomp.global[b[c]];"function"===typeof d&&"function"!=typeof d.prototype[a]&&$jscomp.defineProperty(d.prototype,a,{configurable:!0,writable:!0,value:function(){return $jscomp.iteratorPrototype($jscomp.arrayIteratorImpl(this))}})}return a},"es6",
"es3");$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.keys",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b){return b})}},"es6","es3");
$jscomp.findInternal=function(a,b,c){a instanceof String&&(a=String(a));for(var d=a.length,e=0;e<d;e++){var f=a[e];if(b.call(c,f,e,a))return{i:e,v:f}}return{i:-1,v:void 0}};$jscomp.polyfill("Array.prototype.findIndex",function(a){return a?a:function(b,c){return $jscomp.findInternal(this,b,c).i}},"es6","es3");$jscomp.polyfill("Number.isFinite",function(a){return a?a:function(b){return"number"!==typeof b?!1:!isNaN(b)&&Infinity!==b&&-Infinity!==b}},"es6","es3");
$jscomp.polyfill("Number.isInteger",function(a){return a?a:function(b){return Number.isFinite(b)?b===Math.floor(b):!1}},"es6","es3");
var EasyCoder_Core={name:"EasyCoder_Core",Add:{compile:function(a){var b=a.getLino();a.next();try{var c=a.getValue()}catch(f){return!1}if(a.tokenIs("to"))if(a.next(),a.isSymbol()){var d=a.getSymbol();if(a.getCommandAt(d.pc).isVHolder){if("giving"===a.peek()){d=a.getValue();a.next();var e=a.getToken();a.next();a.addCommand({domain:"core",keyword:"add",lino:b,value1:c,value2:d,target:e})}else d=a.getToken(),a.next(),a.addCommand({domain:"core",keyword:"add",lino:b,value1:c,target:d});return!0}a.warning("core 'add': Expected value holder")}else{d=
a.getValue();if(a.tokenIs("giving"))return a.next(),e=a.getToken(),a.next(),a.addCommand({domain:"core",keyword:"add",lino:b,value1:c,value2:d,target:e}),!0;a.warning("core 'add'': Expected \"giving\"")}return!1},run:function(a){var b=a[a.pc],c=b.value1,d=b.value2,e=a.getSymbolRecord(b.target);if(e.isVHolder){var f=e.value[e.index];d?(a=a.getValue(d)+a.getValue(c),e.value[e.index]={type:"constant",numeric:!0,content:a}):(!f.numeric&&isNaN(f.content)&&a.nonNumericValueError(b.lino),a=parseInt(f.content)+
parseInt(a.getValue(c)),e.value[e.index]={type:"constant",numeric:!0,content:a})}else a.variableDoesNotHoldAValueError(b.lino,e.name);return b.pc+1}},Alias:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getToken();a.next();if(a.tokenIs("to")&&(a.next(),a.isSymbol())){var d=a.getSymbolRecord();d.used=!0;a.next();a.addCommand({domain:"core",keyword:"alias",lino:b,alias:c,symbol:d.name});return!0}}return!1},run:function(a){var b=a[a.pc],c=a.symbols[b.alias].pc,d=a[c],e=a.getSymbolRecord(b.symbol);
a[c]={pc:d.pc,domain:e.domain,keyword:e.keyword,lino:d.lino,name:d.name,alias:b.symbol};return b.pc+1}},Append:{compile:function(a){var b=a.getLino(),c=a.getNextValue();if(a.tokenIs("to")&&a.nextIsSymbol()){var d=a.getSymbolRecord();if(d.isVHolder)return a.next(),a.addCommand({domain:"core",keyword:"append",lino:b,value:c,select:d.name}),!0}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.select);try{var d=a.getValue(b.value),e=["{","["].includes(d[0])?JSON.parse(d):d,f=c.value[c.index],
g=f.content;g=g?JSON.parse(g):[];g.push(e);f.content=JSON.stringify(g);return b.pc+1}catch(h){return a.runtimeError(b.lino,"JSON: Unable to parse value"),!1}}},Begin:{compile:function(a){a.next();a.compileFromHere(["end"]);return!0},run:function(a){return a[a.pc].pc+1}},Callback:{compile:function(a){a.compileVariable("core","callback");return!0},run:function(a){return a[a.pc].pc+1}},Clear:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getSymbolRecord();if(c.isVHolder)return c=
a.getToken(),a.next(),a.addCommand({domain:"core",keyword:"clear",lino:b,symbol:c}),!0;a.warning("'Variable '"+c.name+"' does not hold a value")}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.symbol);c.isVHolder?(a.domain[c.domain].value.put(c,{type:"boolean",content:!1}),b.numeric=!1):a.variableDoesNotHoldAValueError(b.lino,c.name);return b.pc+1}},Close:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if("module"===c.keyword)return a.next(),a.addCommand({domain:"core",
keyword:"close",lino:b,module:c.name}),!0}return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.module);a=EasyCoder.scripts[a.program];a.run(a.onClose);return b.pc+1}},Continue:{compile:function(a){a.next();return a.continue=!0}},Debug:{compile:function(a){var b=a.getLino();if(a.nextTokenIs("program")){a.next();if(["item","pc"].includes(a.getToken())){var c=a.getNextValue();a.addCommand({domain:"core",keyword:"debug",lino:b,item:c});return!0}a.addCommand({domain:"core",keyword:"debug",lino:b,
item:"program"});return!0}return a.tokenIs("symbols")?(a.next(),a.addCommand({domain:"core",keyword:"debug",lino:b,item:"symbols"}),!0):a.tokenIs("symbol")?(c=a.nextToken(),a.next(),a.addCommand({domain:"core",keyword:"debug",lino:b,item:"symbol",name:c}),!0):a.tokenIs("step")?(a.next(),a.addCommand({domain:"core",keyword:"debug",lino:b,item:"step"}),!0):!1},run:function(a){var b=a[a.pc],c=b.item;switch(c){case "symbols":console.log("Symbols: "+JSON.stringify(a.symbols,null,2));break;case "symbol":a=
a.getSymbolRecord(b.name);c=a.exporter.script;delete a.exporter;console.log("Symbol: "+JSON.stringify(a,null,2));a.exporter.script=c;break;case "step":a.debugStep=!0;break;case "program":console.log("Debug program: "+JSON.stringify(a,null,2));break;default:0<=c.content&&console.log("Debug item "+c.content+": "+JSON.stringify(a[c.content],null,2))}return b.pc+1}},Decode:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getToken();a.next();a.addCommand({domain:"core",keyword:"decode",
lino:b,symbol:c});return!0}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.symbol);if(c.isVHolder){var d=a.getValue(c.value[c.index]);c.value[c.index]={type:"constant",numeric:!1,content:a.decode(d)};b.numeric=!1}else a.variableDoesNotHoldAValueError(b.lino,c.name);return b.pc+1}},Divide:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbol();var d=a.getCommandAt(c.pc).name}try{var e=a.getValue()}catch(f){return!1}a.tokenIs("by")&&a.next();c=a.getValue();if(a.tokenIs("giving")){a.next();
if(a.isSymbol())return d=a.getSymbol(),d=a.getCommandAt(d.pc).name,a.next(),a.addCommand({domain:"core",keyword:"divide",lino:b,value1:e,value2:c,target:d}),!0;a.warning("core 'divide'': Expected value holder")}else return"undefined"===typeof d&&a.warning("core 'divide': No target variable given"),a.addCommand({domain:"core",keyword:"divide",lino:b,value2:c,target:d}),!0;return!1},run:function(a){var b=a[a.pc],c=b.value1,d=b.value2,e=a.getSymbolRecord(b.target);if(e.isVHolder){var f=e.value[e.index];
c?(a=a.getValue(c)/a.getValue(d),e.value[e.index]={type:"constant",numeric:!0,content:Math.trunc(a)}):(!f.numeric&&isNaN(f.content)&&a.nonNumericValueError(b,lino),a=parseInt(f.content)/parseInt(a.getValue(d)),e.value[e.index]={type:"constant",numeric:!0,content:Math.trunc(a)})}else a.variableDoesNotHoldAValueError(b.lino,e.name);return b.pc+1}},Dummy:{compile:function(a){var b=a.getLino();a.next();a.addCommand({domain:"core",keyword:"dummy",lino:b});return!0},run:function(a){return a[a.pc].pc+1}},
Encode:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getToken();a.next();a.addCommand({domain:"core",keyword:"encode",lino:b,symbol:c});return!0}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.symbol);if(c.isVHolder){var d=a.getValue(c.value[c.index]);c.value[c.index]={type:"constant",numeric:!1,content:a.encode(d)};b.numeric=!1}else a.variableDoesNotHoldAValueError(b.lino,c.name);return b.pc+1}},End:{compile:function(a){a.next();return!0},run:function(){return 0}},
Exit:{compile:function(a){a.next();a.addCommand({domain:"core",keyword:"exit"});return!0},run:function(a){var b=EasyCoder.scripts[a.parent],c=a.unblocked;a.exit();!c&&b&&(b.run(b.nextPc),b.nextPc=0);return 0}},Filter:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if(a.nextTokenIs("with")){var d=a.nextToken();a.next();a.addCommand({domain:"core",keyword:"filter",lino:b,array:c.name,func:d});return!0}}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.array),
d=c.value[c.index].content,e=a.getSymbolRecord(b.func).pc;try{var f=JSON.parse(d).filter(function(g){c.a=g;a.run(e);return c.v});c.value[c.index].content=JSON.stringify(f)}catch(g){a.runtimeError(b.lino,"Can't parse this array")}return b.pc+1}},Fork:{compile:function(a){var b=a.getLino();a.next();a.nextTokenIs("to")&&a.next();var c=a.getToken();a.next();a.addCommand({domain:"core",keyword:"fork",lino:b,label:c});return!0},run:function(a){var b=a[a.pc];try{a.run(a.symbols[b.label].pc)}catch(c){console.log(c.message),
alert(c.message)}return b.pc+1}},Go:{compile:function(a){var b=a.getLino();a.nextTokenIs("to")&&a.next();var c=a.getToken();a.next();a.addCommand({domain:"core",keyword:"go",lino:b,label:c});return!0},run:function(a){var b=a[a.pc];if(b.label){if(a.verifySymbol(b.label)){var c=a.symbols[b.label];if(c)return c.pc}a.runtimeError(b.lino,"Unknown symbol '"+b.label+"'");return 0}return b.goto}},Gosub:{compile:function(a){var b=a.getLino();a.nextTokenIs("to")&&a.next();var c=a.getToken();a.next();a.addCommand({domain:"core",
keyword:"gosub",lino:b,label:c});return!0},run:function(a){var b=a[a.pc];if(a.verifySymbol(b.label))return a.stack.push(a.pc+1),a.symbols[b.label].pc;a.runtimeError(b.lino,"Unknown symbol '"+b.label+"'");return 0}},If:{compile:function(a){var b=a.getLino();a.next();var c=a.condition.compile(a),d=a.getPc();a.addCommand({domain:"core",keyword:"if",lino:b,condition:c});a.compileOne();if(!a.getToken())return a.getCommandAt(d).else=a.getPc(),!0;a.tokenIs("else")?(c=a.getPc(),a.addCommand({domain:"core",
keyword:"goto",lino:b,goto:0}),a.getCommandAt(d).else=a.getPc(),a.next(),a.compileOne(!0),a.getCommandAt(c).goto=a.getPc()):a.getCommandAt(d).else=a.getPc();return!0},run:function(a){var b=a[a.pc];return a.condition.test(a,b.condition)?b.pc+1:b.else}},Import:{compile:function(a){var b=a.imports,c=EasyCoder.scripts[b.caller],d=a.getProgram();if(b.length){b=$jscomp.makeIterator(b);for(var e=b.next();!e.done;e=b.next()){e=c.getSymbolRecord(e.value);var f=a.nextToken(),g=e.keyword;if(f===g){if(f=a.compileVariable(e.domain,
g,!0),f=d[a.getSymbols()[f.name].pc],f.element=e.element,f.exporter=e.exporter?e.exporter:c.script,f.exportedName=e.name,f.extra=e.extra,f.isVHolder=e.isVHolder,e.program&&(f.program=e.program.script),f.imported=!0,!a.tokenIs("and"))break}else throw Error("Mismatched import variable type for '"+e.name+"'");}if(a.tokenIs("and"))throw Error("Imports do not match exports");}else a.next();return!0},run:function(a){return a[a.pc].pc+1}},Index:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol(!0)){var c=
a.getToken();if(a.nextTokenIs("to")){var d=a.getNextValue();a.addCommand({domain:"core",keyword:"index",lino:b,symbol:c,value:d});return!0}}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.symbol),d=a.getValue(b.value);d>=c.elements&&a.runtimeError(b.lino,"Array index "+d+" is out of range for '"+c.name+"'");c.index=d;c.imported&&(EasyCoder.symbols[c.exporter].getSymbolRecord(c.exportedName).index=d);return b.pc+1}},Module:{compile:function(a){a.compileVariable("core","module");return!0},
run:function(a){return a[a.pc].pc+1}},Multiply:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getSymbol();var d=a.getCommandAt(c.pc).name}try{var e=a.getValue()}catch(f){return!1}a.tokenIs("by")&&a.next();c=a.getValue();if(a.tokenIs("giving")){a.next();if(a.isSymbol())return d=a.getSymbol(),d=a.getCommandAt(d.pc).name,a.next(),a.addCommand({domain:"core",keyword:"multiply",lino:b,value1:e,value2:c,target:d}),!0;a.warning("core multiply: Expected value holder")}else return"undefined"===
typeof d&&a.warning("core multiply: No target variable given"),a.addCommand({domain:"core",keyword:"multiply",lino:b,value2:c,target:d}),!0;return!1},run:function(a){var b=a[a.pc],c=b.value1,d=b.value2,e=a.getSymbolRecord(b.target);if(e.isVHolder){var f=e.value[e.index];c?(a=a.getValue(c)*a.getValue(d),e.value[e.index]={type:"constant",numeric:!0,content:a}):(!f.numeric&&isNaN(f.content)&&a.nonNumericValueError(b,lino),a=parseInt(f.content)*parseInt(a.getValue(d)),e.value[e.index]={type:"constant",
numeric:!0,content:a})}else a.variableDoesNotHoldAValueError(b.lino,e.name);return b.pc+1}},Negate:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getToken();a.next();a.addCommand({domain:"core",keyword:"negate",lino:b,symbol:c});return!0}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.symbol);c.isVHolder?c.value[c.index]={type:"constant",numeric:!0,content:-c.value[c.index].content}:a.variableDoesNotHoldAValueError(b.lino,c.name);return b.pc+1}},On:{compile:function(a){var b=
a.getLino(),c=a.nextToken();switch(c){case "close":case "message":case "error":return a.next(),a.addCommand({domain:"core",keyword:"on",lino:b,action:c}),a.completeHandler()}return a.isSymbol()&&(c=a.getSymbolRecord(),"callback"===c.keyword)?(a.next(),a.addCommand({domain:"core",keyword:"on",lino:b,action:c.name}),a.completeHandler()):!1},run:function(a){var b=a[a.pc],c=b.pc+2;switch(b.action){case "close":a.onClose=c;break;case "message":a.onMessage=c;break;case "error":a.onError=c;break;default:var d=
a.getSymbolRecord(b.action);if(d)d.cb=c;else return a.runtimeError(b.lino,"Unknown action '"+b.action+"'"),0}return b.pc+1}},Print:{compile:function(a){var b=a.getLino();a.next();var c=a.getValue();a.addCommand({domain:"core",keyword:"print",lino:b,value:c});return!0},run:function(a){var b=a[a.pc];a=a.getFormattedValue(b.value);console.log("-> "+a);return b.pc+1}},Put:{compile:function(a){var b=a.getLino(),c=a.getNextValue();if(a.tokenIs("into")){if(a.nextIsSymbol()){var d=a.getToken();a.next();a.addCommand({domain:"core",
keyword:"put",lino:b,value:c,target:d});return!0}a.warning("core:put: No such variable: '"+a.getToken()+"'")}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.target);c.isVHolder||a.variableDoesNotHoldAValueError(b.lino,c.name);a=a.evaluate(b.value);c.value[c.index]={type:a.type,numeric:a.numeric,content:a.content};c.imported&&(c=EasyCoder.scripts[c.exporter].getSymbolRecord(c.exportedName),c.value[c.index]=a);return b.pc+1}},Replace:{compile:function(a){var b=a.getLino(),c=a.getNextValue();
if(a.tokenIs("with")){var d=a.getNextValue();if(a.tokenIs("in")&&a.nextIsSymbol()){var e=a.getSymbolRecord();if(e.isVHolder)return a.next(),a.addCommand({domain:"core",keyword:"replace",lino:b,original:c,replacement:d,target:e.name}),!0;throw Error("'"+e.name+"' does not hold a value");}}return!1},run:function(a){var b=a[a.pc],c=a.getValue(b.original),d=a.getValue(b.replacement),e=a.getSymbolRecord(b.target);a=a.getValue(e.value[e.index]);var f="";try{f=a.split(c).join(d)}catch(g){}e.value[e.index]=
{type:"constant",numeric:!1,content:f};return b.pc+1}},Require:{compile:function(a){var b=a.getLino(),c=a.nextToken();if(["css","js"].includes(c)){var d=a.getNextValue();a.addCommand({domain:"core",keyword:"require",lino:b,type:c,url:d});return!0}throw Error("File type must be 'css' or 'js'");},run:function(a){var b=a[a.pc];a.require(b.type,a.getValue(b.url),function(){a.run(b.pc+1)});return 0}},Return:{compile:function(a){var b=a.getLino();a.next();a.addCommand({domain:"core",keyword:"return",lino:b});
return!0},run:function(a){return a.stack.pop()}},Run:{compile:function(a){var b=a.getLino(),c=a.getNextValue(),d=[];if(a.tokenIs("with"))for(;;)if(a.nextIsSymbol(!0)){var e=a.getSymbolRecord();d.push(e.name);a.next();if(!a.tokenIs("and"))break}if(a.tokenIs("as")&&a.nextIsSymbol(!0)){var f=a.getSymbolRecord();a.next();if("module"!==f.keyword)throw Error("'"+f.name+"' is not a module");f=f.name}var g=!1;a.tokenIs("nowait")&&(a.next(),g=!0);e=a.getPc();a.addCommand({domain:"core",keyword:"run",lino:b,
script:c,imports:d,module:f,nowait:g,then:0});a.tokenIs("then")&&(b=a.getPc(),a.addCommand({domain:"core",keyword:"goto",goto:0}),a.getCommandAt(e).then=a.getPc(),a.next(),a.compileOne(!0),a.addCommand({domain:"core",keyword:"stop"}),a.getCommandAt(b).goto=a.getPc());return!0},run:function(a){a.nextPc=a.pc+1;a.runScript(a);return 0}},Sanitize:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getToken();a.next();a.addCommand({domain:"core",keyword:"sanitize",lino:b,name:c});return!0}return!1},
run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.name);a=a.value[a.index];a.content=JSON.stringify(JSON.parse(a.content));return b.pc+1}},Script:{compile:function(a){var b=a.getProgram();b.script=a.nextToken();a.script=b.script;if(EasyCoder.scripts[b.script])throw delete a.script,Error("Script '"+b.script+"' is already running.");EasyCoder.scripts[b.script]=b;a.next();return!0},run:function(a){return a[a.pc].pc+1}},Send:{compile:function(a){var b=a.getLino(),c="";a.nextTokenIs("to")||(c=a.getValue());
if(a.tokenIs("to")){if(a.nextTokenIs("parent"))var d="parent";else if(a.isSymbol){d=a.getSymbolRecord();if("module"!==d.keyword)throw Error("'"+d.name+"' is not a module");d=d.name}a.next();a.addCommand({domain:"core",keyword:"send",lino:b,message:c,recipient:d})}return!0},run:function(a){var b=a[a.pc],c=a.getValue(b.message);"parent"===b.recipient?a.parent&&(a=EasyCoder.scripts[a.parent],a.onMessage&&(a.message=c,a.run(a.onMessage))):(a=a.getSymbolRecord(b.recipient),a.program&&(a=EasyCoder.scripts[a.program],
a.message=c,a.run(a.onMessage)));return b.pc+1}},Set:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if(!c.isVHolder)return!1;if(a.nextTokenIs("to")){var d=a.nextToken();if(["array","object"].includes(d))return a.next(),a.addCommand({domain:"core",keyword:"set",lino:b,request:"setVarTo",target:c.name,type:d}),!0;for(d=[];;){a.mark();try{d.push(a.getValue())}catch(f){a.rewind();break}}a.addCommand({domain:"core",keyword:"set",lino:b,request:"setArray",target:c.name,
value:d});return!0}a.addCommand({domain:"core",keyword:"set",lino:b,request:"setBoolean",target:c.name});return!0}switch(a.getToken()){case "ready":return a.next(),a.addCommand({domain:"core",keyword:"set",lino:b,request:"setReady"}),!0;case "element":c=a.getNextValue();if(a.tokenIs("of")&&a.nextIsSymbol()&&(d=a.getSymbolRecord(),"variable"===d.keyword&&a.nextTokenIs("to"))){var e=a.getNextValue();a.addCommand({domain:"core",keyword:"set",lino:b,request:"setElement",target:d.name,index:c,value:e});
return!0}break;case "property":c=a.getNextValue();if(a.tokenIs("of")&&a.nextIsSymbol()&&(d=a.getSymbolRecord(),"variable"===d.keyword&&a.nextTokenIs("to")))return e=a.getNextValue(),a.addCommand({domain:"core",keyword:"set",lino:b,request:"setProperty",target:d.name,name:c,value:e}),!0;break;case "arg":if(c=a.getNextValue(),a.tokenIs("of")&&a.nextIsSymbol()&&(d=a.getSymbolRecord(),a.nextTokenIs("to")))return e=a.getNextValue(),a.addCommand({domain:"core",keyword:"set",lino:b,request:"setArg",target:d.name,
name:c,value:e}),!0}a.tokenIs("the")&&a.next();switch(a.getToken()){case "elements":a.next();if(a.tokenIs("of")){a.next();if(!a.isSymbol())throw Error("Unknown variable '"+a.getToken()+"'");c=a.getToken();a.next();if(a.tokenIs("to"))return a.next(),d=a.getValue(),a.addCommand({domain:"core",keyword:"set",lino:b,request:"setElements",symbol:c,value:d}),!0}break;case "encoding":if(a.nextTokenIs("to"))return c=a.getNextValue(),a.addCommand({domain:"core",keyword:"set",request:"encoding",lino:b,encoding:c}),
!0;a.addWarning("Unknown encoding option");break;case "payload":if(a.nextTokenIs("of")&&a.nextIsSymbol()&&(c=a.getSymbolRecord(),"callback"===c.keyword&&a.nextTokenIs("to")))return d=a.getNextValue(),a.addCommand({domain:"core",keyword:"set",request:"setPayload",lino:b,callback:c.name,payload:d}),!0}return!1},run:function(a){var b=a[a.pc];switch(b.request){case "setBoolean":var c=a.getSymbolRecord(b.target);c.isVHolder?(c.value[c.index]={type:"boolean",content:!0},b.numeric=!1):a.variableDoesNotHoldAValueError(b.lino,
c.name);break;case "setReady":if(c=EasyCoder.scripts[a.parent])c.run(c.nextPc),c.nextPc=0,a.unblocked=!0;break;case "setArray":c=a.getSymbolRecord(b.target);c.elements=b.value.length;c.value=b.value;break;case "encoding":a.encoding=a.getValue(b.encoding);break;case "setElements":c=a.getSymbolRecord(b.symbol);var d=c.elements;c.elements=a.getValue(b.value);c.index=0;if(c.elements>d)for(a=d;a<c.elements;a++)c.value.push({}),c.element.push(null);else c.value=c.value.slice(0,c.elements),c.element=c.element.slice(0,
c.elements);break;case "setElement":c=a.getSymbolRecord(b.target);d=a.getValue(b.index);var e=JSON.parse(a.getValue(c.value[c.index])),f=a.getValue(b.value);a.isJsonString(f)&&(f=JSON.parse(f));e[d]=f;c.value[c.index].content=JSON.stringify(e);break;case "setProperty":d=a.getValue(b.name);e=a.getValue(b.value);a.isJsonString(e)&&(e=JSON.parse(e));c=a.getSymbolRecord(b.target);f=c.value[c.index];f.numeric||(f=f.content,""===f?f={}:a.isJsonString(f)&&(f=JSON.parse(f)),f[d]=e,f=JSON.stringify(f),c.value[c.index]=
{type:"constant",numeric:!1,content:f});break;case "setPayload":a.getSymbolRecord(b.callback).payload=a.getValue(b.payload);break;case "setArg":d=a.getValue(b.name);c=a.getSymbolRecord(b.target);c[d]=a.getValue(b.value);break;case "setVarTo":c=a.getSymbolRecord(b.target),c.value[c.index]={type:"constant",numeric:!1,content:"array"===b.type?"[]":"{}"}}return b.pc+1}},Sort:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if(a.nextTokenIs("with")){var d=a.nextToken();
a.next();a.addCommand({domain:"core",keyword:"sort",lino:b,array:c.name,func:d});return!0}}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.array),d=c.value[c.index].content,e=a.getSymbolRecord(b.func).pc;try{var f=JSON.parse(d);f.sort(function(g,h){c.a=g;c.b=h;a.run(e);return c.v});c.value[c.index].content=JSON.stringify(f)}catch(g){a.runtimeError(b.lino,"Can't parse this array")}return b.pc+1}},Split:{compile:function(a){var b=a.getLino();item=a.getNextValue();var c="\n";a.tokenIs("on")&&
(c=a.getNextValue());if(["giving","into"].includes(a.getToken())&&a.nextIsSymbol()){var d=a.getSymbolRecord();if("variable"===d.keyword)return a.next(),a.addCommand({domain:"core",keyword:"split",lino:b,item:item,on:c,target:d.name}),!0}return!1},run:function(a){var b=a[a.pc],c=a.getValue(b.item),d=a.getValue(b.on);c=c.split(d);d=c.length;targetRecord=a.getSymbolRecord(b.target);targetRecord.elements=d;for(a=0;a<d;a++)targetRecord.value[a]={type:"constant",numeric:!1,content:c[a]};targetRecord.index=
0;return b.pc+1}},Stop:{compile:function(a){var b=a.getLino();a.next();if(a.more()&&a.isSymbol()&&!a.getToken().endsWith(":")){var c=a.getSymbolRecord();return"module"===c.keyword?(a.next(),a.addCommand({domain:"core",keyword:"stop",lino:b,name:c.name}),!0):!1}a.addCommand({domain:"core",keyword:"stop",lino:b,next:0});return!0},run:function(a){var b=a[a.pc];if(b.name)a=a.getSymbolRecord(b.name),EasyCoder.scripts[a.program].exit(),a.program=null;else return 0;return b.pc+1}},Take:{compile:function(a){var b=
a.getLino();a.next();try{var c=a.getValue()}catch(f){return!1}if(a.tokenIs("from"))if(a.next(),a.isSymbol()){var d=a.getSymbol();if(a.getCommandAt(d.pc).isVHolder){if("giving"===a.peek()){d=a.getValue();a.next();var e=a.getToken();a.next();a.addCommand({domain:"core",keyword:"take",lino:b,value1:c,value2:d,target:e})}else d=a.getToken(),a.next(),a.addCommand({domain:"core",keyword:"take",lino:b,value1:c,target:d});return!0}a.warning("core 'take'': Expected value holder")}else{d=a.getValue();if(a.tokenIs("giving"))return a.next(),
e=a.getToken(),a.next(),a.addCommand({domain:"core",keyword:"take",lino:b,value1:c,value2:d,target:e}),!0;a.warning("core 'take'': Expected \"giving\"")}return!1},run:function(a){var b=a[a.pc],c=b.value1,d=b.value2,e=a.getSymbolRecord(b.target);if(e.isVHolder){var f=e.value[e.index];d?(a=a.getValue(d)-a.getValue(c),e.value[e.index]={type:"constant",numeric:!0,content:a}):(!f.numeric&&isNaN(f.content)&&a.nonNumericValueError(b.lino),a=parseInt(a.getValue(f))-parseInt(a.getValue(c)),e.value[e.index]=
{type:"constant",numeric:!0,content:a})}else a.variableDoesNotHoldAValueError(b.lino,e.name);return b.pc+1}},Toggle:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getSymbolPc();a.next();a.addCommand({domain:"core",keyword:"toggle",lino:b,symbol:c});return!0}return!1},run:function(a){var b=a[a.pc],c=a[b.symbol];if(c.isVHolder){var d=a.domain[c.domain];a=d.value.get(a,c.value[c.index]).content;d.value.put(c,{type:"boolean",content:!a})}else a.variableDoesNotHoldAValueError(b.lino,
c.name);return b.pc+1}},Variable:{compile:function(a){a.compileVariable("core","variable",!0);return!0},run:function(a){return a[a.pc].pc+1}},Wait:{compile:function(a){var b=a.getLino();a.next();var c=a.getValue(a),d=1E3;switch(a.getToken()){case "milli":case "millis":a.next();d=1;break;case "tick":case "ticks":a.next();d=10;break;case "second":case "seconds":a.next();d=1E3;break;case "minute":case "minutes":a.next(),d=6E4}a.addCommand({domain:"core",keyword:"wait",lino:b,value:c,multiplier:d});return!0},
run:function(a){var b=a[a.pc],c=a.getValue(b.value);setTimeout(function(){a.run&&a.run(b.pc+1)},c*b.multiplier);return 0}},While:{compile:function(a){var b=a.getLino();a.next();var c=a.getCondition(),d=a.getPc();a.addCommand({domain:"core",keyword:"while",lino:b,condition:c});b=a.getPc();a.addCommand({domain:"core",keyword:"goto",goto:0});a.compileOne();a.addCommand({domain:"core",keyword:"goto",goto:d});a.getCommandAt(b).goto=a.getPc();return!0},run:function(a){return a.condition.test(a,a[a.pc].condition)?
a.pc+2:a.pc+1}},getHandler:function(a){switch(a){case "add":return EasyCoder_Core.Add;case "alias":return EasyCoder_Core.Alias;case "append":return EasyCoder_Core.Append;case "begin":return EasyCoder_Core.Begin;case "callback":return EasyCoder_Core.Callback;case "clear":return EasyCoder_Core.Clear;case "close":return EasyCoder_Core.Close;case "continue":return EasyCoder_Core.Continue;case "debug":return EasyCoder_Core.Debug;case "decode":return EasyCoder_Core.Decode;case "divide":return EasyCoder_Core.Divide;
case "dummy":return EasyCoder_Core.Dummy;case "encode":return EasyCoder_Core.Encode;case "end":return EasyCoder_Core.End;case "exit":return EasyCoder_Core.Exit;case "filter":return EasyCoder_Core.Filter;case "fork":return EasyCoder_Core.Fork;case "go":case "goto":return EasyCoder_Core.Go;case "gosub":return EasyCoder_Core.Gosub;case "if":return EasyCoder_Core.If;case "import":return EasyCoder_Core.Import;case "index":return EasyCoder_Core.Index;case "module":return EasyCoder_Core.Module;case "multiply":return EasyCoder_Core.Multiply;
case "negate":return EasyCoder_Core.Negate;case "on":return EasyCoder_Core.On;case "print":return EasyCoder_Core.Print;case "put":return EasyCoder_Core.Put;case "replace":return EasyCoder_Core.Replace;case "require":return EasyCoder_Core.Require;case "return":return EasyCoder_Core.Return;case "run":return EasyCoder_Core.Run;case "sanitize":return EasyCoder_Core.Sanitize;case "script":return EasyCoder_Core.Script;case "send":return EasyCoder_Core.Send;case "set":return EasyCoder_Core.Set;case "sort":return EasyCoder_Core.Sort;
case "split":return EasyCoder_Core.Split;case "stop":return EasyCoder_Core.Stop;case "subtract":case "take":return EasyCoder_Core.Take;case "toggle":return EasyCoder_Core.Toggle;case "variable":return EasyCoder_Core.Variable;case "wait":return EasyCoder_Core.Wait;case "while":return EasyCoder_Core.While;default:return!1}},run:function(a){var b=a[a.pc],c=EasyCoder_Core.getHandler(b.keyword);c||a.runtimeError(b.lino,"Unknown keyword '"+b.keyword+"' in 'core' package");return c.run(a)},isNegate:function(a){return"not"===
a.getToken()?(a.next(),!0):!1},value:{compile:function(a){if(a.isSymbol()){var b=a.getToken();switch(a.getSymbolRecord().keyword){case "module":return a.next(),{domain:"core",type:"module",name:b};case "variable":var c=a.nextToken();return["format","modulo"].includes(c)?(a=a.getNextValue(),{domain:"core",type:c,name:b,value:a}):{domain:"core",type:"symbol",name:b}}return null}b=a.getToken();if("true"===b)return a.next(),{domain:"core",type:"boolean",content:!0};if("false"===b)return a.next(),{domain:"core",
type:"boolean",content:!1};if("random"===b)return a.next(),{domain:"core",type:"random",range:a.getValue()};if("cos"===b)return a.next(),b=a.getValue(),a.skip("radius"),a=a.getValue(),{domain:"core",type:"cos",angle_c:b,radius_c:a};if("sin"===b)return a.next(),b=a.getValue(),a.skip("radius"),a=a.getValue(),{domain:"core",type:"sin",angle_s:b,radius_s:a};if("tan"===b)return a.next(),b=a.getValue(),a.skip("radius"),a=a.getValue(),{domain:"core",type:"tan",angle_t:b,radius_t:a};if("now today newline backtick break empty uuid".split(" ").includes(b))return a.next(),
{domain:"core",type:b};if("date"===b)return{domain:"core",type:"date",value:a.getNextValue()};if(["encode","decode","lowercase","hash","reverse"].includes(b))return a.next(),a=a.getValue(),{domain:"core",type:b,value:a};if("element"===b)return b=a.getNextValue(),a.tokenIs("of")&&a.nextIsSymbol()&&(c=a.getSymbolRecord(),a.next(),"variable"===c.keyword)?{domain:"core",type:"element",element:b,symbol:c.name}:null;if("property"===b)return b=a.getNextValue(),a.tokenIs("of")&&a.nextIsSymbol()&&(c=a.getSymbolRecord(),
a.next(),"variable"===c.keyword)?{domain:"core",type:"property",property:b,symbol:c.name}:null;if("arg"===b){var d=a.getNextValue();if(a.tokenIs("of")&&a.nextIsSymbol())return b=a.getSymbolRecord(),a.next(),{domain:"core",type:"arg",value:d,target:b.name}}if(["character","char"].includes(b)&&(b=a.getNextValue(),a.tokenIs("of")))return a=a.getNextValue(),{domain:"core",type:"char",index:b,value:a};a.tokenIs("the")&&a.next();b=a.getToken();switch(b){case "elements":if(["of","in"].includes(a.nextToken())&&
a.nextIsSymbol())return c=a.getToken(),a.next(),{domain:"core",type:b,name:c};break;case "index":if(a.nextTokenIs("of")){if(a.nextIsSymbol()){if("in"===a.peek())return b=a.getValue(),a=a.getNextValue(),{domain:"core",type:"indexOf",value1:b,value2:a};c=a.getToken();a.next();return{domain:"core",type:b,name:c}}b=a.getValue();if(a.tokenIs("in"))return a=a.getNextValue(),{domain:"core",type:"indexOf",value1:b,value2:a}}break;case "value":if(a.nextTokenIs("of"))return a.next(),{domain:"core",type:"valueOf",
value:a.getValue()};break;case "length":if(a.nextTokenIs("of"))return a.next(),{domain:"core",type:"lengthOf",value:a.getValue()};break;case "left":case "right":try{if(c=a.getNextValue(),a.tokenIs("of")){var e=a.getNextValue();return{domain:"core",type:b,count:c,value:e}}}catch(f){}break;case "from":c=a.getNextValue();e=a.tokenIs("to")?a.getNextValue():null;if(a.tokenIs("of"))return a=a.getNextValue(),{domain:"core",type:b,from:c,to:e,value:a};break;case "position":b=!1;a.nextTokenIs("nocase")&&(b=
!0,a.next());if(a.tokenIs("of")&&(c=!1,a.nextTokenIs("the")&&a.nextTokenIs("last")&&(a.next(),c=!0),e=a.getValue(),a.tokenIs("in")))return a=a.getNextValue(),{domain:"core",type:"position",needle:e,haystack:a,last:c,nocase:b};break;case "payload":if(a.nextTokenIs("of")&&a.nextIsSymbol()&&(b=a.getSymbolRecord(),"callback"===b.keyword))return a.next(),{domain:"core",type:"payload",callback:b.name};break;case "message":case "error":case "millisecond":return a.next(),{domain:"core",type:b}}return null},
get:function(a,b){switch(b.type){case "boolean":return{type:"boolean",numeric:!1,content:b.content};case "elements":return{type:"constant",numeric:!0,content:a.getSymbolRecord(b.name).elements};case "index":return{type:"constant",numeric:!0,content:a.getSymbolRecord(b.name).index};case "random":return a=a.evaluate(b.range),{type:"constant",numeric:!0,content:Math.floor(Math.random()*a.content)};case "cos":var c=a.getValue(b.angle_c);a=a.getValue(b.radius_c);return{type:"constant",numeric:!0,content:parseInt(Math.cos(.01745329*
parseFloat(c))*a,10)};case "sin":return c=a.getValue(b.angle_s),a=a.getValue(b.radius_s),{type:"constant",numeric:!0,content:parseInt(Math.sin(.01745329*parseFloat(c))*a,10)};case "tan":return c=a.getValue(b.angle_t),a=a.getValue(b.radius_t),{type:"constant",numeric:!0,content:parseInt(Math.tan(.01745329*parseFloat(c))*a,10)};case "valueOf":return a=parseInt(a.getValue(b.value)),{type:"constant",numeric:!0,content:a?a:0};case "lengthOf":return{type:"constant",numeric:!0,content:a.getValue(b.value).length};
case "left":return{type:"constant",numeric:!1,content:a.getValue(b.value).substr(0,a.getValue(b.count))};case "right":return c=a.getValue(b.value),{type:"constant",numeric:!1,content:c.substr(c.length-a.getValue(b.count))};case "from":c=a.getValue(b.from);var d=b.to?a.getValue(b.to):null;a=a.getValue(b.value);return{type:"constant",numeric:!1,content:d?a.substr(c,d):a.substr(c)};case "position":return c=a.getValue(b.needle),a=a.getValue(b.haystack),b.nocase&&(c=c.toLowerCase(),a=a.toLowerCase()),
{type:"constant",numeric:!0,content:b.last?a.lastIndexOf(c):a.indexOf(c)};case "payload":return{type:"constant",numeric:!1,content:a.getSymbolRecord(b.callback).payload};case "modulo":return c=a.getSymbolRecord(b.name),a=a.evaluate(b.value),{type:"constant",numeric:!0,content:c.value[c.index].content%a.content};case "format":c=a.getSymbolRecord(b.name);c=1E3*a.getValue(c.value[c.index]);try{switch(d=JSON.parse(a.getValue(b.value)),d.mode){case "time":return{type:"constant",numeric:!0,content:(new Date(c)).toLocaleTimeString(d.locale,
d.options)};default:var e=new Date(c);return{type:"constant",numeric:!1,content:"iso"===d.format?e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate():e.toLocaleDateString(d.locale,d.options)}}}catch(f){a.runtimeError(a[a.pc].lino,"Can't parse "+b.value);break}case "empty":return{type:"constant",numeric:!1,content:""};case "now":return{type:"constant",numeric:!0,content:Math.floor(Date.now()/1E3)};case "millisecond":return{type:"constant",numeric:!0,content:Math.floor(Date.now())};case "today":return a=
new Date,a.setHours(0,0,0,0),{type:"constant",numeric:!0,content:Math.floor(a.getTime()/1E3)};case "date":c=Date.parse(a.getValue(b.value))/1E3;if(isNaN(c)){a.runtimeError(a[a.pc].lino,"Invalid date format; expecting 'yyyy-mm-dd'");break}return{type:"constant",numeric:!0,content:c};case "newline":return{type:"constant",numeric:!1,content:"\n"};case "backtick":return{type:"constant",numeric:!1,content:"`"};case "break":return{type:"constant",numeric:!1,content:"<br />"};case "uuid":return{type:"constant",
numeric:!1,content:"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var g=16*Math.random()|0;return("x"==f?g:g&3|8).toString(16)})};case "encode":return{type:"constant",numeric:!1,content:a.encode(a.getValue(b.value))};case "decode":return{type:"constant",numeric:!1,content:a.decode(a.getValue(b.value))};case "reverse":return{type:"constant",numeric:!1,content:a.getValue(b.value).split("").reverse().join("")};case "lowercase":return{type:"constant",numeric:!1,content:a.getValue(b.value).toLowerCase()};
case "hash":a=a.getValue(b.value);b=0;if(0===a.length)return b;for(c=0;c<a.length;c++)d=a.charCodeAt(c),b=(b<<5)-b+d;return{type:"constant",numeric:!0,content:b};case "element":c=a.getValue(b.element);b=a.getSymbolRecord(b.symbol);d="";try{d=JSON.parse(a.getValue(b.value[b.index]))[c]}catch(f){a.runtimeError(a[a.pc].lino,"Can't parse JSON");break}return{type:"constant",numeric:!1,content:"object"===typeof d?JSON.stringify(d):d};case "property":d=a.getValue(b.property);b=a.getSymbolRecord(b.symbol);
a=a.getValue(b.value[b.index]);c="";if(d&&a)if("object"===typeof a)c=a[d];else if(["{","]"].includes(a.charAt(0)))try{c=JSON.parse(a)[d]}catch(f){console.log("Can't parse '"+a+"': "+f.message)}return{type:"constant",numeric:!Array.isArray(c)&&!isNaN(c),content:"object"===typeof c?JSON.stringify(c):c};case "module":return{type:"boolean",numeric:!1,content:a.getSymbolRecord(b.name).program};case "message":return c=a.message,{type:"constant",numeric:!1,content:c};case "error":return c=a.errorMessage,
{type:"constant",numeric:!1,content:c};case "indexOf":d=a.getValue(b.value1);b=a.getValue(b.value2);try{return c=JSON.parse(b).indexOf(d),{type:"constant",numeric:!0,content:c}}catch(f){a.runtimeError(a[a.pc].lino,"Can't parse "+b)}break;case "arg":return c=a.getValue(b.value),c=a.getSymbolRecord(b.target)[c],{type:"constant",numeric:!isNaN(c),content:c};case "char":return c=a.getValue(b.index),{type:"constant",numeric:!1,content:a.getValue(b.value)[c]}}return null},put:function(a,b){a.value[a.index]=
b}},condition:{compile:function(a){if(a.isSymbol()){var b=a.getSymbolRecord();if("module"===b.keyword){if(a.nextTokenIs("is")){var c=!0;a.nextTokenIs("not")&&(a.next(),c=!1);if(a.tokenIs("running"))return a.next(),{domain:"core",type:"moduleRunning",name:b.name,sense:c}}return null}}if(a.tokenIs("not"))return{domain:"core",type:"not",value:a.getNextValue()};try{c=a.getValue();var d=a.getToken();if("includes"===d){var e=a.getNextValue();return{domain:"core",type:"includes",value1:c,value2:e}}if("is"===
d){a.next();var f=EasyCoder_Core.isNegate(a);switch(a.getToken()){case "numeric":return a.next(),{domain:"core",type:"numeric",value1:c,negate:f};case "even":return a.next(),{domain:"core",type:"even",value1:c};case "odd":return a.next(),{domain:"core",type:"odd",value1:c};case "greater":a.next();if(a.tokenIs("than")){a.next();var g=a.getValue();return{domain:"core",type:"greater",value1:c,value2:g,negate:f}}break;case "less":a.next();if(a.tokenIs("than")){a.next();var h=a.getValue();return{domain:"core",
type:"less",value1:c,value2:h,negate:f}}break;default:var k=a.getValue();return{domain:"core",type:"is",value1:c,value2:k,negate:f}}}else if(c)return{domain:"core",type:"boolean",value:c}}catch(l){return a.warning("Can't get a value"),0}return null},test:function(a,b){switch(b.type){case "boolean":return a.getValue(b.value);case "numeric":var c=a.getValue(b.value1);c=" "===c||isNaN(c);return b.negate?c:!c;case "even":return 0===a.getValue(b.value1)%2;case "odd":return 1===a.getValue(b.value1)%2;case "is":return c=
a.compare(a,b.value1,b.value2),b.negate?0!==c:0===c;case "greater":return c=a.compare(a,b.value1,b.value2),b.negate?0>=c:0<c;case "less":return c=a.compare(a,b.value1,b.value2),b.negate?0<=c:0>c;case "not":return!a.getValue(b.value);case "moduleRunning":return c=a.getSymbolRecord(b.name),"undefined"!==typeof c.program?(c=EasyCoder.scripts[c.program])?b.sense?c.running:!c.running:!b.sense:!b.sense;case "includes":return c=a.getValue(b.value1),b=a.getValue(b.value2),c.includes(b)}return!1}}},EasyCoder_Browser=
{name:"EasyCoder_Browser",A:{compile:function(a){a.compileVariable("browser","a",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Alert:{compile:function(a){var b=a.getLino(),c=a.getNextValue();a.addCommand({domain:"browser",keyword:"alert",lino:b,value:c});return!0},run:function(a){var b=a[a.pc];a=a.getFormattedValue(b.value);alert(a);return b.pc+1}},Attach:{compile:function(a){var b=a.getLino();a.next();if(a.isSymbol()){var c=a.getSymbolRecord(),d=c.keyword;switch(d){case "a":case "blockquote":case "button":case "canvas":case "div":case "fieldset":case "file":case "form":case "h1":case "h2":case "h3":case "h4":case "h5":case "h6":case "image":case "img":case "input":case "label":case "legend":case "li":case "option":case "p":case "pre":case "select":case "span":case "table":case "td":case "text":case "textarea":case "tr":case "ul":a.next();
if(a.tokenIs("to")){if(a.nextTokenIs("body"))if("div"===d){var e="body";a.next()}else throw Error("Body variable must be a div");else e=a.getValue();var f=0;a.tokenIs("or")&&(a.next(),f=a.getPc()+1,a.completeHandler());a.addCommand({domain:"browser",keyword:"attach",lino:b,type:d,symbol:c.name,cssId:e,onError:f});return!0}break;default:return a.addWarning("type '"+c.keyword+"' not recognized in browser 'attach'"),!1}}a.addWarning("Unrecognised syntax in 'attach'");return!1},run:function(a){var b=
a[a.pc],c=null;if("body"===b.cssId){var d=a.getSymbolRecord(b.symbol);d.element[d.index]=document.body;d.value[d.index]={type:"constant",numeric:!1,content:c}}else return c=a.value.evaluate(a,b.cssId).content,EasyCoder_Browser.Attach.getElementById(a,b,c,100),0;"popup"===b.type&&(a.popups.push(null.id),window.onclick=function(e){a.popups.includes(e.target.id)&&(e.target.style.display="none")});return b.pc+1},getElementById:function(a,b,c,d){if(element=document.getElementById(c)){if(a.run){var e=a.getSymbolRecord(b.symbol);
e.element[e.index]=element;e.value[e.index]={type:"constant",numeric:!1,id:c};a.run(b.pc+1)}}else 0<d?setTimeout(function(){EasyCoder_Browser.Attach.getElementById(a,b,c,--d)},10):element||(b.onError?a.run(b.onError):a.runtimeError(b.lino,"No such element: '"+c+"'"))}},Audioclip:{compile:function(a){a.compileVariable("browser","audioclip");return!0},run:function(a){return a[a.pc].pc+1}},BLOCKQUOTE:{compile:function(a){a.compileVariable("browser","blockquote",!1,"dom");return!0},run:function(a){return a[a.pc].pc+
1}},BUTTON:{compile:function(a){a.compileVariable("browser","button",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},CANVAS:{compile:function(a){a.compileVariable("browser","canvas",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Click:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if("select"===c.keyword)return a.next(),a.addCommand({domain:"browser",keyword:"click",lino:b,target:c.name}),!0}return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.target);
a.element[a.index].dispatchEvent(new Event("click"));return b.pc+1}},Clear:{compile:function(a){var b=a.getLino(),c=a.nextToken();return["body","styles"].includes(c)?(a.next(),a.addCommand({domain:"browser",keyword:"clear",lino:b,name:c}),!0):a.isSymbol()&&(c=a.getSymbolRecord(),"dom"===c.extra)?(a.next(),a.addCommand({domain:"browser",keyword:"clear",lino:b,name:c.name}),!0):!1},run:function(a){var b=a[a.pc];switch(b.name){case "body":document.body.innerHTML="";break;case "styles":document.querySelectorAll('link[rel="stylesheet"]').forEach(function(d){return d.parentNode.removeChild(d)});
document.querySelectorAll("style").forEach(function(d){return d.parentNode.removeChild(d)});break;default:a=a.getSymbolRecord(b.name);var c=a.element[a.index];switch(a.keyword){case "input":case "textarea":c.value="";break;default:c.innerHTML=""}}return b.pc+1}},Convert:{compile:function(a){var b=a.getLino();if(a.nextTokenIs("whitespace")&&a.nextTokenIs("in")&&a.nextIsSymbol()){var c=a.getSymbolRecord();if(c.isVHolder&&a.nextTokenIs("to")){var d=a.nextToken();a.next();a.addCommand({domain:"browser",
keyword:"convert",lino:b,name:c.name,mode:d});return!0}}return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.name);var c=a.value[a.index].content;switch(b.mode){case "print":c=c.split("%0a").join("\n").split("%0A").join("\n").split("%0d").join("").split("$0D").join("");break;case "html":c=c.split("%0a").join("<br />").split("%0A").join("<br />").split("%0d").join("").split("$0D").join("")}a.value[a.index].content=c;return b.pc+1}},Copy:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=
a.getSymbolRecord();if("input"===c.keyword)return a.next(),a.addCommand({domain:"browser",keyword:"copy",lino:b,name:c.name}),!0}return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.name);a=a.element[a.index];a.select();a.setSelectionRange(0,99999);document.execCommand("copy");return b.pc+1}},Create:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord(),d=c.keyword;if("audioclip"===d)return a.nextTokenIs("from")?(d=a.getNextValue(),a.addCommand({domain:"browser",
keyword:"create",type:"audioclip",name:c.name,lino:b,value:d}),!0):!1;if("a blockquote button canvas div fieldset file form h1 h2 h3 h4 h5 h6 hr image img input label legend li option p pre progress select span table tr td text textarea ul".split(" ").includes(d))if(a.nextTokenIs("in")){if(a.nextTokenIs("body"))return a.next(),a.addCommand({domain:"browser",keyword:"create",lino:b,name:c.name,parent:"body"}),!0;if(a.isSymbol())return d=a.getSymbolRecord(),a.next(),a.addCommand({domain:"browser",keyword:"create",
lino:b,name:c.name,parent:d.name}),!0}else{if((d=a.imports)&&0<d.length&&"Codex"===a.parent)return a.addCommand({domain:"browser",keyword:"create",lino:b,name:c.name,parent:d[0],imported:!0}),!0;a.addCommand({domain:"browser",keyword:"create",lino:b,name:c.name,parent:"body"});return!0}}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.name);switch(b.type){case "audioclip":c.value[c.index]=b.value;break;default:if("body"===b.parent)a=document.body;else{var d=(b.imported?EasyCoder.scripts[a.parent]:
a).getSymbolRecord(b.parent);d.element[d.index]||a.runtimeError(b.pc,"Element "+d.name+" does not exist.");a=d.element[d.index]}c.element[c.index]=document.createElement(c.keyword);c.element[c.index].id="ec-"+c.name+"-"+c.index+"-"+EasyCoder.elementId++;"a"===c.keyword&&c.element[c.index].setAttribute("href","#");a.appendChild(c.element[c.index])}return b.pc+1}},Disable:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getToken();a.next();a.addCommand({domain:"browser",keyword:"disable",
lino:b,symbol:c});return!0}a.addWarning("Unrecognised syntax in 'disable'");return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.symbol);document.getElementById(a.value[a.index].content).disabled="true";return b.pc+1}},DIV:{compile:function(a){a.compileVariable("browser","div",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Enable:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getToken();a.next();a.addCommand({domain:"browser",keyword:"enable",lino:b,symbol:c});
return!0}a.addWarning("Unrecognised syntax in 'enable'");return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.symbol);document.getElementById(a.value[a.index].content).disabled=!1;return b.pc+1}},FIELDSET:{compile:function(a){a.compileVariable("browser","fieldset",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},FILE:{compile:function(a){a.compileVariable("browser","file",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Focus:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=
a.getToken();a.next();a.addCommand({domain:"browser",keyword:"focus",lino:b,symbol:c});return!0}a.addWarning("Unrecognised syntax in 'focus'");return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.symbol);a.element[a.index].focus();return b.pc+1}},FORM:{compile:function(a){a.compileVariable("browser","form",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Get:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getToken(),d=a.getSymbolRecord();if(a.nextTokenIs("from")){if(a.nextTokenIs("storage"))return a.nextTokenIs("as")?
(d=a.getNextValue(),a.addCommand({domain:"browser",keyword:"get",action:"getStorage",lino:b,target:c,key:d})):a.addCommand({domain:"browser",keyword:"get",action:"listStorage",lino:b,target:c}),!0;if(a.isSymbol()){var e=a.getSymbolRecord();if("select"===e.keyword){if("option"===d.keyword)return a.next(),a.addCommand({domain:"browser",keyword:"get",action:"getOption",lino:b,target:c,select:e.name}),!0;throw Error("Invalid variable type");}if("form"!==e.keyword)throw Error("Invalid variable type");
a.next();a.addCommand({domain:"browser",keyword:"get",action:"getForm",lino:b,target:c,form:e.name});return!0}}}a.addWarning("Unrecognised syntax in 'get'");return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.target);switch(b.action){case "getForm":a=a.getSymbolRecord(b.form);a=document.getElementById(a.value[a.index].content);var d=new FormData(a);a={};d=$jscomp.makeIterator(d);for(var e=d.next();!e.done;e=d.next())e=e.value,a[e[0]]=e[1].replace(/\r/g,"").replace(/\n/g,"%0a");c.value[c.index]=
{type:"constant",numeric:!1,content:JSON.stringify(a)};break;case "listStorage":a=[];d=0;for(e=window.localStorage.length;d<e;d++)a.push(localStorage.key(d));c.value[c.index]={type:"constant",numeric:!1,content:JSON.stringify(a)};break;case "getStorage":a=window.localStorage.getItem(a.getValue(b.key));"undefined"===typeof a&&(a=null);c.value[c.index]={type:"constant",numeric:!1,content:a};break;case "getOption":a=a.getSymbolRecord(b.select),a=a.element[a.index],c.element[c.index]=a.options[a.selectedIndex]}return b.pc+
1}},H1:{compile:function(a){a.compileVariable("browser","h1",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},H2:{compile:function(a){a.compileVariable("browser","h2",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},H3:{compile:function(a){a.compileVariable("browser","h3",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},H4:{compile:function(a){a.compileVariable("browser","h4",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},H5:{compile:function(a){a.compileVariable("browser",
"h5",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},H6:{compile:function(a){a.compileVariable("browser","h6",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Highlight:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if("dom"===c.extra)return a.next(),a.addCommand({domain:"browser",keyword:"highlight",lino:b,name:c.name}),!0}return!1},run:function(a){var b=a[a.pc];a=a.getSymbolRecord(b.name);a.element[a.index].select();return b.pc+1}},History:{compile:function(a){var b=
a.getLino(),c=a.nextToken();switch(c){case "push":case "set":case "replace":a.next();for(var d="",e="",f="";;){var g=a.getToken();if("url"===g)d=a.getNextValue();else if("state"===g)e=a.getNextValue();else if("title"===g)f=a.getNextValue();else break}a.addCommand({domain:"browser",keyword:"history",lino:b,type:c,url:d,state:e,title:f});return!0;case "pop":case "back":case "forward":return a.next(),a.addCommand({domain:"browser",keyword:"history",lino:b,type:c}),!0}return!1},run:function(a){a.script||
(a.script="script"+Date.now()/1E3);var b=a[a.pc],c=a.getValue(b.state);c||(c='{"script":"'+a.script+'"}');var d=a.getValue(b.title),e=a.getValue(b.url);switch(b.type){case "push":if(!window.history.state)return a.runtimeError(b.lino,"No state history; you need to call 'history set' on the parent"),0;window.history.pushState(c,"",e);break;case "set":case "replace":window.history.replaceState(c,d,e);break;case "pop":case "back":window.history.back();break;case "forward":window.history.forward()}return b.pc+
1}},HR:{compile:function(a){a.compileVariable("browser","hr",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},IMAGE:{compile:function(a){a.compileVariable("browser","image",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},IMG:{compile:function(a){a.compileVariable("browser","img",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},INPUT:{compile:function(a){a.compileVariable("browser","input",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},LABEL:{compile:function(a){a.compileVariable("browser",
"label",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},LEGEND:{compile:function(a){a.compileVariable("browser","legend",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},LI:{compile:function(a){a.compileVariable("browser","li",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Location:{compile:function(a){var b=a.getLino(),c=!1;a.nextTokenIs("new")&&(c=!0,a.next());var d=a.getValue();a.addCommand({domain:"browser",keyword:"location",lino:b,location:d,newWindow:c});return!0},
run:function(a){var b=a[a.pc];a=a.getValue(b.location);b.newWindow?window.open(a,"_blank"):window.location=a;return b.pc+1}},Mail:{compile:function(a){var b=a.getLino();if(a.nextTokenIs("to")){var c=a.getNextValue(),d="",e="";a.tokenIs("subject")&&(d=a.getNextValue(),a.tokenIs("body")||a.tokenIs("message"))&&(a.next(),e=a.getValue());a.addCommand({domain:"browser",keyword:"mail",lino:b,to:c,subject:d,body:e});return!0}return!1},run:function(a){var b=a[a.pc];window.location.href=b.subject?"mailto:"+
a.getValue(b.to)+("?subject="+a.getValue(b.subject)+"&body="+encodeURIComponent(a.getValue(b.body))):"mailto:"+a.getValue(b.to);return b.pc+1}},On:{compile:function(a){var b=a.getLino(),c=a.nextToken();switch(c){case "change":a.next();if(a.isSymbol()){var d=a.getSymbolRecord();a.next();if("dom"!==d.extra)return!1;a.addCommand({domain:"browser",keyword:"on",lino:b,action:c,symbol:d.name});return a.completeHandler()}break;case "click":if(a.nextTokenIs("document"))return a.next(),a.addCommand({domain:"browser",
keyword:"on",lino:b,action:"clickDocument"}),a.completeHandler();if(a.isSymbol()){d=a.getSymbolRecord();a.next();if("dom"!==d.extra)return!1;a.addCommand({domain:"browser",keyword:"on",lino:b,action:c,symbol:d.name});return a.completeHandler()}break;case "key":case "leave":return a.next(),a.addCommand({domain:"browser",keyword:"on",lino:b,action:c}),a.completeHandler();case "window":return a.nextTokenIs("resize")?(a.next(),a.addCommand({domain:"browser",keyword:"on",lino:b,action:"windowResize"}),
a.completeHandler()):!1;case "browser":case "restore":if("browser"===c&&!a.nextTokenIs("back"))return!1;a.next();a.addCommand({domain:"browser",keyword:"on",lino:b,action:"browserBack"});return a.completeHandler();case "swipe":return["left","right"].includes(a.nextToken())?(c=a.getToken(),a.next(),a.addCommand({domain:"browser",keyword:"on",lino:b,action:"swipe",direction:c}),a.completeHandler()):!1;case "pick":if(a.nextIsSymbol()){d=a.getSymbolRecord();a.next();if("dom"!==d.extra)return!1;a.addCommand({domain:"browser",
keyword:"on",lino:b,action:c,symbol:d.name});return a.completeHandler()}return!1;case "drag":case "drop":return a.next(),a.addCommand({domain:"browser",keyword:"on",lino:b,action:c}),a.completeHandler()}a.addWarning("Unrecognised syntax in 'on'");return!1},run:function(a){var b=a[a.pc];switch(b.action){case "change":var c=a.getSymbolRecord(b.symbol);c.program=a.script;c.element.forEach(function(f,g){f&&(f.targetRecord=c,f.targetIndex=g,f.targetPc=b.pc+2,f.addEventListener("change",function(h){h.stopPropagation();
if(0<a.length){var k=h.target;"undefined"!==typeof k.targetRecord&&(k.targetRecord.index=k.targetIndex,setTimeout(function(){EasyCoder.timestamp=Date.now();EasyCoder.scripts[k.targetRecord.program].run(k.targetPc)},1))}}))});break;case "click":c=a.getSymbolRecord(b.symbol);c.program=a.script;c.element.forEach(function(f,g){f&&(f.targetRecord=c,f.targetIndex=g,f.targetPc=b.pc+2,f.onclick=function(h){h.stopPropagation();EasyCoder_Browser.clickData={target:f,clientX:h.clientX,clientY:h.clientY};if(0<
a.length){var k=h.target;"radio"!=k.type&&k.blur();"undefined"!==typeof k.targetRecord&&(k.targetRecord.index=k.targetIndex,setTimeout(function(){EasyCoder.timestamp=Date.now();EasyCoder.scripts[k.targetRecord.program].run(k.targetPc)},1))}return!1})});break;case "clickDocument":a.targetPc=b.pc+2;var d=function(f){EasyCoder.timestamp=Date.now();for(var g=f.target||f.srcElement,h="";g.parentNode;){if("A"===g.tagName){h=g.href;a.docPath=h.slice(-(h.length-window.location.href.length));break}g=g.parentNode}for(;g.parentNode;){if(0===
g.id.indexOf("ec-")){g=g.id.slice(3);var k=g.indexOf("-");a.varName=g.slice(0,k);g=g.slice(k+1);k=g.indexOf("-");a.varIndex=parseInt(g.slice(0,k));break}g=g.parentNode}0===h.indexOf(window.location.href)&&(a.run(a.targetPc),f.preventDefault())};document.addEventListener?document.addEventListener("click",d):document.attachEvent&&document.attachEvent("onclick",d);break;case "swipe":var e;switch(b.direction){case "left":a.onSwipeLeft=b.pc+2;break;case "right":a.onSwipeRight=b.pc+2}document.addEventListener("touchstart",
function(f){e=(f.touches||f.originalEvent.touches)[0].clientX},!1);document.addEventListener("touchmove",function(f){f.stopImmediatePropagation();e&&(f=e-f.touches[0].clientX,150<Math.abs(f)&&(e=null,0<f&&a.onSwipeLeft?a.run(a.onSwipeLeft):0>f&&a.onSwipeRight&&a.run(a.onSwipeRight)))},!1);break;case "pick":d=a.getSymbolRecord(b.symbol);document.pickRecord=d;d.element.forEach(function(f,g){f&&(document.pickIndex=g,f.pickIndex=g,f.mouseDownPc=b.pc+2,"ontouchstart"in f?(f.addEventListener("touchstart",
function(h){var k=h.targetTouches[0].target;document.pickX=h.touches[0].clientX;document.pickY=h.touches[0].clientY;k.blur();setTimeout(function(){document.pickRecord.index=k.pickIndex;a.run(k.mouseDownPc)},1)},!1),f.addEventListener("touchmove",function(h){document.dragX=h.touches[0].clientX;document.dragY=h.touches[0].clientY;setTimeout(function(){a.run(document.mouseMovePc)},1);return!1},!1),f.addEventListener("touchend",function(){setTimeout(function(){a.run(document.mouseUpPc)},1);return!1})):
f.onmousedown=function(h){h=h?h:window.event;h.stopPropagation();if(0<a.length){var k=h.target?h.target:h.srcElement;k.offsetX=h.offsetX;k.offsetY=h.offsetY;document.pickX=h.clientX;document.pickY=h.clientY;k.blur();setTimeout(function(){document.pickRecord.index=k.pickIndex;a.run(k.mouseDownPc)},1)}document.onmousemove=function(l){l=l?l:window.event;l.stopPropagation();document.dragX=l.clientX;document.dragY=l.clientY;document.onmousemove&&setTimeout(function(){a.run(document.mouseMovePc)},1);return!1};
window.onmouseup=function(){document.onmousemove=null;document.onmouseup=null;setTimeout(function(){a&&a.run&&a.run(document.mouseUpPc)},1);return!1};return!1})});break;case "drag":document.mouseMovePc=b.pc+2;break;case "drop":document.mouseUpPc=b.pc+2;break;case "key":"undefined"===typeof document.onKeyListeners&&(document.onKeyListeners=[]);document.onKeyListeners.includes(a)||document.onKeyListeners.push(a);a.onKeyPc=b.pc+2;document.onkeydown=function(f){for(var g={},h=$jscomp.makeIterator(document.onKeyListeners),
k=h.next();!k.done;g={$jscomp$loop$prop$program$75$142:g.$jscomp$loop$prop$program$75$142},k=h.next()){g.$jscomp$loop$prop$program$75$142=k.value;g.$jscomp$loop$prop$program$75$142.key=f.key;try{setTimeout(function(l){return function(){l.$jscomp$loop$prop$program$75$142.run(l.$jscomp$loop$prop$program$75$142.onKeyPc)}}(g),1)}catch(l){console.log("Error: "+l.message)}}return!0};break;case "windowResize":a.onWindowResize=b.pc+2;window.addEventListener("resize",function(){a.run(a.onWindowResize)});break;
case "browserBack":a.onBrowserBack=b.pc+2;break;case "leave":window.addEventListener("beforeunload",function(){a.run(b.pc+2)})}return b.pc+1}},OPTION:{compile:function(a){a.compileVariable("browser","option",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},P:{compile:function(a){a.compileVariable("browser","p",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Play:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord();if("audioclip"===c.keyword)return a.next(),
a.addCommand({domain:"browser",keyword:"play",lino:b,target:c.name}),!0}return!1},run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.target);a=a.value.evaluate(a,c.value[c.index]).content;(new Audio(a)).play();return b.pc+1}},PRE:{compile:function(a){a.compileVariable("browser","pre",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},PROGRESS:{compile:function(a){a.compileVariable("browser","progress",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Put:{compile:function(a){var b=
a.getLino(),c=a.getNextValue();if(a.tokenIs("into")&&a.nextTokenIs("storage")&&a.nextTokenIs("as")){var d=a.getNextValue();a.addCommand({domain:"browser",keyword:"put",lino:b,value:c,key:d});return!0}return!1},run:function(a){var b=a[a.pc];window.localStorage.setItem(a.getValue(b.key),a.getValue(b.value));return b.pc+1}},Remove:{compile:function(a){var b=a.getLino();if(a.nextTokenIs("element")&&a.nextIsSymbol()){var c=a.getSymbolRecord();if("dom"!=c.extra)return a.warning("'"+c.name+"' is not a DOM element"),
!1;a.next();a.addCommand({domain:"browser",keyword:"remove",type:"removeElement",lino:b,element:c.name});return!0}if(a.tokenIs("attribute")&&(c=a.getNextValue(),a.tokenIs("of")&&a.nextIsSymbol())){var d=a.getSymbolRecord();if("dom"!==d.extra)throw Error("Inappropriate type '"+d.keyword+"'");a.next();a.addCommand({domain:"browser",keyword:"remove",type:"removeAttribute",lino:b,attribute:c,target:d.name});return!0}try{if(d=a.getValue(),a.tokenIs("from")&&a.nextTokenIs("storage"))return a.next(),a.addCommand({domain:"browser",
keyword:"remove",type:"removeStorage",key:d}),!0}catch(e){}return!1},run:function(a){var b=a[a.pc];switch(b.type){case "removeAttribute":var c=a.getValue(b.attribute);a=a.getSymbolRecord(b.target);target=a.element[a.index];target.removeAttribute(c);break;case "removeElement":c=a.getSymbolRecord(b.element);(c=c.element[c.index])&&c.parentElement.removeChild(c);break;case "removeStorage":c=a.getValue(b.key),window.localStorage.removeItem(c)}return b.pc+1}},Request:{compile:function(a){var b=a.getLino();
if("fullscreen"===a.nextToken()){var c="";"exit"===a.nextToken()&&(c="exit",a.next());a.addCommand({domain:"browser",keyword:"request",lino:b,option:c});return!0}return!1},run:function(a){a=a[a.pc];"exit"===a.option?document.exitFullscreen():document.documentElement.requestFullscreen();return a.pc+1}},SELECT:{compile:function(a){a.compileVariable("browser","select",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Scroll:{compile:function(a){var b=a.getLino(),c=null;a.nextIsSymbol()&&(c=a.getSymbolRecord().name,
a.next());if(a.tokenIs("to")){var d=a.getNextValue();a.addCommand({domain:"browser",keyword:"scroll",lino:b,name:c,to:d});return!0}return!1},run:function(a){var b=a[a.pc],c=a.getValue(b.to);b.name?(a=a.getSymbolRecord(b.name),a.element[a.index].scrollTo(0,c)):window.scrollTo(0,c);return b.pc+1}},SECTION:{compile:function(a){a.compileVariable("browser","section",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Set:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getSymbolRecord(),
d=c.name;if("dom"===c.extra&&"from"===a.nextToken()&&a.nextIsSymbol()){if("select"===c.keyword){c=a.getSymbolRecord();if("variable"===c.keyword){var e=null;a.nextTokenIs("as")&&(e=a.getNextValue());a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setSelect",select:d,source:c.name,display:e});return!0}return!1}c=a.getToken();a.next();a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setContentVar",source:c,target:d});return!0}}else{var f=a.getToken();"the"===f&&(f=a.nextToken());if("title"===
f){if(a.nextTokenIs("to"))return d=a.getNextValue(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setTitle",value:d}),!0}else if("content"===f){if(a.nextTokenIs("of")){if(a.nextIsSymbol()){d=a.getToken();if(a.nextTokenIs("from")&&a.nextIsSymbol())return c=a.getToken(),a.next(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setContentVar",source:c,target:d}),!0;if(a.tokenIs("to"))return c=a.getNextValue(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setContent",
value:c,target:d}),!0}throw Error("'"+a.getToken()+"' is not a symbol");}}else if("class"===f){if(a.nextTokenIs("of")&&a.nextIsSymbol()&&(d=a.getSymbolRecord(),"dom"===d.extra&&a.nextTokenIs("to")))return c=a.getNextValue(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setClass",symbolName:d.name,value:c}),!0}else if("id"===f){if(a.nextTokenIs("of")&&a.nextIsSymbol()&&(d=a.getSymbolRecord(),"dom"===d.extra&&a.nextTokenIs("to")))return c=a.getNextValue(),a.addCommand({domain:"browser",
keyword:"set",lino:b,type:"setId",symbolName:d.name,value:c}),!0}else if("text"===f){if(a.nextTokenIs("of")&&a.nextIsSymbol())switch(d=a.getSymbolRecord(),d.keyword){case "button":case "input":case "span":case "label":case "legend":if(a.nextTokenIs("to"))return c=a.getNextValue(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setText",symbolName:d.name,value:c}),!0}}else if("size"===f){if(a.nextTokenIs("of")&&a.nextIsSymbol())switch(d=a.getSymbolRecord(),d.keyword){case "input":if(a.nextTokenIs("to"))return c=
a.getNextValue(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setSize",symbolName:d.name,value:c}),!0}}else if("attribute"===f){if(a.next(),d=a.getValue(),a.tokenIs("of")&&a.nextIsSymbol(!0))return c=a.getSymbolRecord().name,a.next(),e={type:"boolean",content:!0},a.tokenIs("to")&&(e=a.getNextValue()),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setAttribute",symbolName:c,attributeName:d,attributeValue:e}),!0}else{if("attributes"===f){if(a.nextTokenIs("of")&&a.nextIsSymbol()){c=
a.getSymbolRecord();d=c.name;if("dom"!==c.extra)return a.warning("'"+d+"' is not a DOM type"),!1;if(a.nextTokenIs("to")&&(c=a.getNextValue()))return a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setAttributes",symbolName:d,attributes:c}),!0}a.warning("'"+a.getToken()+"' is not a symbol");return!1}if("style"===f){if(a.nextTokenIs("of")){if(a.nextIsSymbol()){c=a.getSymbolRecord();d=c.name;if("dom"!==c.extra)return a.warning("'"+d+"' is not a DOM type"),!1;if(a.nextTokenIs("to")&&(c=a.getNextValue()))return a.addCommand({domain:"browser",
keyword:"set",lino:b,type:"setStyles",symbolName:d,styleValue:c}),!0}a.warning("'"+a.getToken()+"' is not a symbol");return!1}d=a.getValue();c="setStyle";e="";f=a.getToken();if("of"===f){if("body"===a.nextToken())c="setBodyStyle";else if(a.isSymbol()){if(f=a.getSymbolRecord(),e=f.name,"dom"!==f.extra)throw Error("'"+e+"' is not a DOM type");}else throw Error("'"+a.getToken()+"' is not a known symbol");if(a.nextTokenIs("to")&&(f=a.getNextValue()))return a.addCommand({domain:"browser",keyword:"set",
lino:b,type:c,symbolName:e,styleName:d,styleValue:f}),!0}else if("to"===f&&(c=a.getNextValue()))return a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setHeadStyle",styleName:d,styleValue:c}),!0}else if("default"===f&&a.nextTokenIs("of")&&a.nextIsSymbol()&&(d=a.getSymbolRecord(),"select"===d.keyword&&a.nextTokenIs("to")))return c=a.getNextValue(),a.addCommand({domain:"browser",keyword:"set",lino:b,type:"setDefault",name:d.name,value:c}),!0}}a.addWarning("Unrecognised syntax in 'set'");return!1},
run:function(a){var b=a[a.pc];switch(b.type){case "setContentVar":var c=a.getSymbolRecord(b.source);var d=a.getSymbolRecord(b.target);var e=document.getElementById(c.value[c.index].content);var f=d.element[d.index];f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c));f.innerHTML=e.innerHTML;break;case "setContent":c=a.getValue(b.value);d=a.getSymbolRecord(b.target);f=d.element[d.index];if(!f){e=d.value[d.index].content;if(!e)return a.runtimeError(b.lino,"Variable '"+d.name+"' has not been attached to a DOM element."),
0;f=document.getElementById(e)}d.element[d.index]=f;switch(d.keyword){case "text":case "textarea":case "input":f.value=c;break;default:f.innerHTML=c}break;case "setSelect":sourceRecord=a.getSymbolRecord(b.source);d=a.getValue(sourceRecord.value[sourceRecord.index]);c="";try{c=JSON.parse(d)}catch(l){return a.runtimeError(b.lino,"Can't parse JSON"),0}d=a.getSymbolRecord(b.select);var g=d.element[d.index];g.options.length=0;var h=a.getValue(b.display);c.forEach(function(l){var n=h?a.decode(l[h]):null,
r=document.createElement("option");r.innerHTML=n?n:l;l=n?JSON.stringify(l):l;r.value=l;g.appendChild(r)});g.selectedIndex=h?c.indexOf(h):-1;break;case "setClass":d=a.getSymbolRecord(b.symbolName);f=d.element[d.index];f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c));a.getValue(b.value).split(" ").forEach(function(l){f.classList.remove(l);f.classList.add(l)});break;case "setId":d=a.getSymbolRecord(b.symbolName);f=d.element[d.index];f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c));
f.id=a.getValue(b.value);break;case "setText":d=a.getSymbolRecord(b.symbolName);f=d.element[d.index];f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c));c=a.getValue(b.value);switch(d.keyword){case "button":case "span":case "label":case "legend":f.innerHTML=c;break;case "input":f.value=c}break;case "setSize":d=a.getSymbolRecord(b.symbolName);"input"===d.keyword?(f=d.element[d.index],f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c)),f.size=a.getValue(b.value)):a.runtimeError(b.lino,
"Inappropriate variable type '"+d.name+"'");break;case "setAttribute":d=a.getSymbolRecord(b.symbolName);f=d.element[d.index];f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c));c=a.getValue(b.attributeName);"boolean"===b.attributeValue.type?f.setAttribute(c,b.attributeValue.content):f.setAttribute(c,a.getValue(b.attributeValue));break;case "setAttributes":d=a.getSymbolRecord(b.symbolName);f=d.element[d.index];f||(c=a.getValue(d.value[d.index]),f=document.getElementById(c));for(c=f.attributes.length-
1;0<=c;c--)f.removeAttribute(f.attributes[c].name);c=a.getValue(b.attributes).split(" ");for(d=0;d<c.length;d++){e=c[d];var k=e.indexOf("=");0<k?f.setAttribute(e.substr(0,k),e.substr(k+1)):f.setAttribute(e,e)}break;case "setStyle":case "setStyles":d=a.getSymbolRecord(b.symbolName);f=d.element[d.index];if(!f){c=d.value[d.index];if(!c.type)return a.runtimeError(b.lino,"Variable '"+d.name+"' is not attached to a DOM element."),0;c=a.getValue(c);f=document.getElementById(c)}c=a.getValue(b.styleValue);
if(!d.element[d.index])return a.runtimeError(b.lino,"Variable '"+d.name+"' has no DOM element."),0;switch(b.type){case "setStyle":f.style[b.styleName.content]=c;break;case "setStyles":f.style.cssText=c}break;case "setHeadStyle":c=a.getValue(b.styleName);e=a.getValue(b.styleValue);d=document.createElement("style");d.innerHTML=c+" "+e;for(e=0;e<document.head.childNodes.length;e++)if(k=document.head.childNodes[e],"STYLE"===k.tagName&&0===k.innerHTML.indexOf(c+" ")){document.head.removeChild(k);break}document.head.appendChild(d);
break;case "setBodyStyle":c=a.getValue(b.styleValue);switch(b.styleName.content){case "background":document.body.style.background=c;break;default:return a.runtimeError(b.lino,"Unsupported body attribute '"+b.styleName.content+"'"),0}break;case "setTitle":document.title=a.getValue(b.value);break;case "setDefault":for(d=a.getSymbolRecord(b.name),c=a.getValue(b.value),d=d.element[d.index],e=0;e<d.options.length;e++)if(d.options[e].value===c){d.selectedIndex=e;break}}return b.pc+1}},SPAN:{compile:function(a){a.compileVariable("browser",
"span",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},TABLE:{compile:function(a){a.compileVariable("browser","table",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},TR:{compile:function(a){a.compileVariable("browser","tr",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},TD:{compile:function(a){a.compileVariable("browser","td",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},TEXTAREA:{compile:function(a){a.compileVariable("browser","textarea",!1,"dom");return!0},
run:function(a){return a[a.pc].pc+1}},Trace:{compile:function(a){var b=a.getLino(),c=[];if(a.nextIsSymbol()){for(;a.isSymbol();)c.push(a.getToken()),a.next();var d="horizontal";if(a.tokenIs("horizontal")||a.tokenIs("vertical"))d=a.getToken(),a.next();a.addCommand({domain:"browser",keyword:"trace",variant:"setup",lino:b,variables:c,alignment:d});return!0}a.addCommand({domain:"browser",keyword:"trace",variant:"run",lino:b});return!0},run:function(a){var b=a[a.pc];switch(b.variant){case "setup":console.log("Set up tracer");
a.tracer={variables:b.variables,alignment:b.alignment};break;case "run":console.log("Run tracer");a.tracer||(a.tracer={variables:[],alignment:"horizontal"});if(!a.tracing){if(b=document.getElementById("easycoder-tracer"))b.innerHTML='<div><input id="easycoder-run-button" type="button" value="Run" /><input id="easycoder-step-button" type="button" value="Step" /><div id="easycoder-tracer-content" style="border:1px solid black;padding:4px";width:100%></div>',b.style.display="none";a.tracing=!0}a.stop=
!1}return a.pc+1}},UL:{compile:function(a){a.compileVariable("browser","ul",!1,"dom");return!0},run:function(a){return a[a.pc].pc+1}},Upload:{compile:function(a){var b=a.getLino();if(a.nextIsSymbol()){var c=a.getToken();if(a.nextTokenIs("to")){var d=a.getNextValue();if(a.tokenIs("with")&&a.nextIsSymbol()){var e=a.getToken();if(a.nextTokenIs("and")&&a.nextIsSymbol()){var f=a.getToken();a.next();a.addCommand({domain:"browser",keyword:"upload",lino:b,file:c,path:d,progress:e,status:f});return!0}}}}return!1},
run:function(a){var b=a[a.pc],c=a.getSymbolRecord(b.file),d=a.getValue(b.path),e=a.getSymbolRecord(b.progress),f=a.getSymbolRecord(b.status),g=e.element[e.index],h=f.element[f.index],k=function(l){h&&(h.innerHTML=l)};if(e=c.element[c.index].files[0])c=new FormData,c.append("source",e),c.append("path",d),e=new XMLHttpRequest,e.upload.addEventListener("progress",function(l){l=Math.round(l.loaded/l.total*100);g&&(g.value=l);k(Math.round(l)+"%...")},!1),e.addEventListener("load",function(l){l=l.target.responseText;
g&&(g.value=0);k("");l&&console.log(l)},!1),e.addEventListener("error",function(){k("Upload failed");console.log("Upload failed")},!1),e.addEventListener("abort",function(){k("Upload aborted");console.log("Upload aborted")},!1),e.onreadystatechange=function(){if(4===this.readyState){var l=a.ajaxCommand,n=this.status;switch(n){case 200:a.run(l.pc+1);break;case 0:break;default:try{a.runtimeError(l.lino,"Error "+n)}catch(r){a.reportError(r,a)}}}},e.onerror=function(){b.onError?(a.errorMessage=this.responseText,
a.run(b.onError)):a.runtimeError(b.lino,this.responseText)},a.ajaxCommand=b,d=d.startsWith("http")?d:window.location.origin+"/"+EasyCoder_Rest.restPath+"/"+d,e.open("POST",d),e.send(c);return 0}},getHandler:function(a){switch(a){case "a":return EasyCoder_Browser.A;case "alert":return EasyCoder_Browser.Alert;case "attach":return EasyCoder_Browser.Attach;case "audioclip":return EasyCoder_Browser.Audioclip;case "blockquote":return EasyCoder_Browser.BLOCKQUOTE;case "button":return EasyCoder_Browser.BUTTON;
case "canvas":return EasyCoder_Browser.CANVAS;case "clear":return EasyCoder_Browser.Clear;case "click":return EasyCoder_Browser.Click;case "convert":return EasyCoder_Browser.Convert;case "copy":return EasyCoder_Browser.Copy;case "create":return EasyCoder_Browser.Create;case "disable":return EasyCoder_Browser.Disable;case "div":return EasyCoder_Browser.DIV;case "enable":return EasyCoder_Browser.Enable;case "fieldset":return EasyCoder_Browser.FIELDSET;case "file":return EasyCoder_Browser.FILE;case "focus":return EasyCoder_Browser.Focus;
case "form":return EasyCoder_Browser.FORM;case "fullscreen":return EasyCoder_Browser.FullScreen;case "get":return EasyCoder_Browser.Get;case "h1":return EasyCoder_Browser.H1;case "h2":return EasyCoder_Browser.H2;case "h3":return EasyCoder_Browser.H3;case "h4":return EasyCoder_Browser.H4;case "h5":return EasyCoder_Browser.H5;case "h6":return EasyCoder_Browser.H6;case "highlight":return EasyCoder_Browser.Highlight;case "history":return EasyCoder_Browser.History;case "hr":return EasyCoder_Browser.HR;
case "image":return EasyCoder_Browser.IMAGE;case "img":return EasyCoder_Browser.IMG;case "input":return EasyCoder_Browser.INPUT;case "label":return EasyCoder_Browser.LABEL;case "legend":return EasyCoder_Browser.LEGEND;case "li":return EasyCoder_Browser.LI;case "location":return EasyCoder_Browser.Location;case "mail":return EasyCoder_Browser.Mail;case "on":return EasyCoder_Browser.On;case "option":return EasyCoder_Browser.OPTION;case "p":return EasyCoder_Browser.P;case "play":return EasyCoder_Browser.Play;
case "pre":return EasyCoder_Browser.PRE;case "progress":return EasyCoder_Browser.PROGRESS;case "put":return EasyCoder_Browser.Put;case "remove":return EasyCoder_Browser.Remove;case "request":return EasyCoder_Browser.Request;case "select":return EasyCoder_Browser.SELECT;case "scroll":return EasyCoder_Browser.Scroll;case "section":return EasyCoder_Browser.SECTION;case "set":return EasyCoder_Browser.Set;case "span":return EasyCoder_Browser.SPAN;case "table":return EasyCoder_Browser.TABLE;case "tr":return EasyCoder_Browser.TR;
case "td":return EasyCoder_Browser.TD;case "textarea":return EasyCoder_Browser.TEXTAREA;case "trace":return EasyCoder_Browser.Trace;case "ul":return EasyCoder_Browser.UL;case "upload":return EasyCoder_Browser.Upload;default:return null}},run:function(a){var b=a[a.pc],c=EasyCoder_Browser.getHandler(b.keyword);c||a.runtimeError(b.lino,"Unknown keyword '"+b.keyword+"' in 'browser' package");return c.run(a)},value:{compile:function(a){if(a.isSymbol()){var b=a.getSymbolRecord();if(a.nextTokenIs("exists"))return"dom"===
b.extra?(a.next(),{domain:"browser",type:"exists",value:b.name}):null;switch(b.keyword){case "file":case "input":case "select":case "textarea":return{domain:"browser",type:b.keyword,value:b.name}}return null}a.tokenIs("the")&&a.next();var c=!1;a.tokenIs("offset")&&(c=!0,a.next());b=a.getToken();switch(b){case "mobile":case "portrait":case "landscape":case "br":case "location":case "key":case "hostname":return a.next(),{domain:"browser",type:b};case "content":case "text":if(a.nextTokenIs("of")){if(a.nextIsSymbol())return b=
a.getSymbolRecord(),a.next(),{domain:"browser",type:"contentOf",symbol:b.name};throw Error("'"+a.getToken()+"' is not a symbol");}break;case "selected":b=a.nextToken();if(["index","item"].includes(b)&&["in","of"].includes(a.nextToken())&&a.nextIsSymbol()&&(c=a.getSymbolRecord(),["ul","ol","select"].includes(c.keyword)))return a.next(),{domain:"browser",type:"selected",symbol:c.name,arg:b};break;case "color":return a.next(),a=a.getValue(),{domain:"browser",type:b,value:a};case "attribute":c=a.getNextValue();
if(a.tokenIs("of")&&(a.next(),a.isSymbol()&&(b=a.getSymbolRecord(),"dom"===b.extra)))return a.next(),{domain:"browser",type:"attributeOf",attribute:c,symbol:b.name};break;case "style":c=a.getNextValue();if(a.tokenIs("of")&&a.nextIsSymbol()){var d=a.getSymbolRecord();if("dom"===d.extra)return a.next(),{domain:"browser",type:b,style:c,target:d.name}}break;case "confirm":return b=a.getNextValue(),{domain:"browser",type:"confirm",text:b};case "prompt":return b=a.getNextValue(),c=null,a.tokenIs("with")&&
(c=a.getNextValue()),{domain:"browser",type:"prompt",text:b,pre:c};case "screen":c=a.nextToken();if(["width","height"].includes(c))return a.next(),{domain:"browser",type:b,attribute:c};break;case "top":case "bottom":case "left":case "right":case "width":case "height":return EasyCoder_Browser.value.getCoord(a,b,c);case "scroll":if(a.nextTokenIs("position"))return a.next(),{domain:"browser",type:"scrollPosition"};break;case "document":if(a.nextTokenIs("path"))return a.next(),{domain:"browser",type:"docPath"};
break;case "storage":if(a.nextTokenIs("keys"))return a.next(),{domain:"browser",type:"storageKeys"};break;case "parent":switch(a.nextToken()){case "name":return a.next(),{domain:"browser",type:"varName"};case "index":return a.next(),{domain:"browser",type:"varIndex"}}break;case "history":if(a.nextTokenIs("state"))return a.next(),{domain:"browser",type:"historyState"};break;case "pick":case "drag":if(a.nextTokenIs("position"))return a.next(),{domain:"browser",type:b+"Position"};break;case "click":if(b=
a.nextToken(),["left","top"].includes(b))return a.next(),{domain:"browser",type:"click",which:b}}return null},getCoord:function(a,b,c){if(a.nextTokenIs("of")){a.nextTokenIs("the")&&a.nextToken();var d=a.getToken();if(["window","viewport"].includes(d))return a.next(),{domain:"browser",type:b,symbol:d,offset:c};if(a.isSymbol()&&(d=a.getSymbolRecord(),"dom"===d.extra))return a.next(),{domain:"browser",type:b,symbol:d.name,offset:c}}return null},get:function(a,b){switch(b.type){case "file":case "input":case "select":case "textarea":var c=
a.getSymbolRecord(b.value);var d=c.element[c.index];return d?{type:"constant",numeric:!1,content:d.value}:(a.runtimeError(a[a.pc].lino,"Variable '"+c.name+"' is not attached to a DOM element."),null);case "exists":return c=a.getSymbolRecord(b.value),{domain:"browser",type:"boolean",content:"undefined"!==typeof c.element[c.index]};case "mobile":return{domain:"browser",type:"boolean",content:"undefined"!==typeof window.orientation||-1!==navigator.userAgent.indexOf("IEMobile")};case "portrait":return{domain:"browser",
type:"boolean",content:document.documentElement.clientWidth<document.documentElement.clientHeight};case "landscape":return{domain:"browser",type:"boolean",content:document.documentElement.clientWidth>=document.documentElement.clientHeight};case "br":return{type:"constant",numeric:!1,content:decodeURIComponent("%3Cbr%20%2F%3E")};case "attributeOf":return c=a.getSymbolRecord(b.symbol),b=a.getValue(b.attribute),d=c.element[c.index],0===b.indexOf("data-")?a.getSimpleValue(d.dataset[b.substr(5)]):a.getSimpleValue(d[b]);
case "style":return c=a.getSymbolRecord(b.target),b=a.getValue(b.style),d=c.element[c.index],a.getSimpleValue(d.style[b]);case "confirm":return{type:"boolean",content:window.confirm(a.getValue(b.text))};case "prompt":return d=a.getValue(b.text),b=a.getValue(b.pre),{type:"constant",numeric:!1,content:b?window.prompt(d,b):window.prompt(d)};case "contentOf":c=a.getSymbolRecord(b.symbol);d=c.element[c.index];if(null===d||"undefined"===typeof d)return a.runtimeError(a[a.pc].lino,"Variable '"+c.name+"' is not attached to a DOM element."),
null;switch(c.keyword){case "input":case "textarea":b=d.value;break;case "pre":b=d.innerHTML;break;default:b=d.innerHTML.split("\n").join("")}return{type:"constant",numeric:!1,content:b};case "selected":return c=a.getSymbolRecord(b.symbol),d=c.element[c.index],a=d.selectedIndex,d=0<=a?d.options[a].text:"",b="index"===b.arg?a:d,{type:"constant",numeric:!1,content:b};case "top":if("window"==b.symbol)return{type:"constant",numeric:!0,content:window.screenY};c=a.getSymbolRecord(b.symbol);a=c.element[c.index];
b=Math.round(b.offset?a.offsetTop:a.getBoundingClientRect().top);return{type:"constant",numeric:!0,content:b};case "bottom":if("window"==b.symbol)return{type:"constant",numeric:!0,content:window.screenY+window.innerHeight};c=a.getSymbolRecord(b.symbol);b=Math.round(c.element[c.index].getBoundingClientRect().bottom);return{type:"constant",numeric:!0,content:b};case "left":if("window"==b.symbol)return{type:"constant",numeric:!0,content:window.screenLeft};c=a.getSymbolRecord(b.symbol);a=c.element[c.index];
b=Math.round(b.offset?a.offsetLeft:a.getBoundingClientRect().left);return{type:"constant",numeric:!0,content:b};case "right":if("window"==b.symbol)return{type:"constant",numeric:!0,content:window.screenX+window.innerWidth};c=a.getSymbolRecord(b.symbol);b=Math.round(c.element[c.index].getBoundingClientRect().right);return{type:"constant",numeric:!0,content:b};case "width":if("window"==b.symbol)return{type:"constant",numeric:!0,content:window.innerWidth};c=a.getSymbolRecord(b.symbol);b=Math.round(c.element[c.index].getBoundingClientRect().width);
return{type:"constant",numeric:!0,content:b};case "height":if("window"==b.symbol)return{type:"constant",numeric:!0,content:window.innerHeight};c=a.getSymbolRecord(b.symbol);b=Math.round(c.element[c.index].getBoundingClientRect().height);return{type:"constant",numeric:!0,content:b};case "color":return{type:"constant",numeric:!1,content:"#"+a.value.evaluate(a,b.value).content.toString(16).padStart(6,"0")};case "docPath":return{type:"constant",numeric:!1,content:a.docPath};case "storageKeys":return{type:"constant",
numeric:!1,content:JSON.stringify(Object.keys(localStorage))};case "location":return{type:"constant",numeric:!1,content:window.location.href};case "historyState":return{type:"constant",numeric:!1,content:window.history.state};case "scrollPosition":return{type:"constant",numeric:!0,content:scrollPosition};case "varName":return{type:"constant",numeric:!1,content:a.varName};case "varIndex":return{type:"constant",numeric:!0,content:a.varIndex};case "key":return{type:"constant",numeric:!1,content:a.key};
case "hostname":return{type:"constant",numeric:!1,content:location.hostname};case "screen":return{type:"constant",numeric:!0,content:screen[b.attribute]};case "pickPosition":return{type:"constant",numeric:!1,content:JSON.stringify({x:document.pickX,y:document.pickY})};case "dragPosition":return{type:"constant",numeric:!1,content:JSON.stringify({x:document.dragX,y:document.dragY})};case "click":a=EasyCoder_Browser.clickData;if("undefined"===typeof a)return 0;d=a.target.getBoundingClientRect();return{type:"constant",
numeric:!0,content:"left"===b.which?a.clientX-Math.round(d.left):a.clientY-Math.round(d.top)}}}},condition:{compile:function(a){if(a.tokenIs("confirm"))return{domain:"browser",type:"confirm",value:a.getNextValue()};if(a.tokenIs("element")&&a.nextIsSymbol()){var b=a.getSymbolRecord();if("dom"===b.extra){var c=a.nextToken();if("has"===c){if(a.nextTokenIs("the")&&a.next(),a.tokenIs("focus"))return a.next(),{domain:"browser",type:"focus",element:b.name}}else if("contains"===c)return a=a.getNextValue(),
{domain:"browser",type:"contains",element:b.name,position:a}}}return null},test:function(a,b){switch(b.type){case "confirm":return confirm(a.getValue(b.value));case "focus":var c=a.getSymbolRecord(b.element);return c.element[c.index]===document.activeElement;case "contains":c=a.getSymbolRecord(b.element);var d=c.element[c.index].getBoundingClientRect();c=Math.round(d.left);var e=Math.round(d.right),f=Math.round(d.top);d=Math.round(d.bottom);b=JSON.parse(a.getValue(b.position));a=b.x;b=b.y;return a>=
c&&a<=e&&b>=f&&b<=d?!0:!1}}},setStyles:function(a,b){a=document.getElementById(a);b=b.split(";");b=$jscomp.makeIterator(b);for(var c=b.next();!c.done;c=b.next())c=c.value.split(":"),a.setAttribute(c[0],c[1])}},scrollPosition=0;window.addEventListener("scroll",function(){scrollPosition=this.scrollY});window.onpopstate=function(a){window.EasyCoder.timestamp=Date.now();(a=JSON.parse(a.state))&&a.script&&((a=window.EasyCoder.scripts[a.script])?a.onBrowserBack&&a.run(a.onBrowserBack):console.log("No script property in window state object"))};
var EasyCoder_Json={name:"EasyCoder_Json",Json:{compile:function(a){var b=a.getLino(),c=a.nextToken();switch(c){case "set":a.next();if(a.isSymbol())if(c=a.getSymbolRecord(),"variable"===c.keyword){if(a.nextTokenIs("to")){var d=a.nextToken();if('["array","object"]'.includes(d))return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:"setVariable",target:c.name,type:d}),!0}}else if("select"===c.keyword&&a.nextTokenIs("from")&&(a.next(),a.isSymbol()&&(d=a.getSymbolRecord(),"variable"===
d.keyword))){var e=null;a.nextTokenIs("as")&&(e=a.getNextValue());a.addCommand({domain:"json",keyword:"json",lino:b,request:"setList",target:c.name,source:d.name,display:e});return!0}break;case "sort":case "shuffle":case "format":if(a.nextIsSymbol()&&(d=a.getSymbolRecord(),"variable"===d.keyword))return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:c,target:d.name}),!0;break;case "parse":if(a.nextTokenIs("url")&&(d=a.getNextValue(),a.tokenIs("as")&&a.nextIsSymbol()&&(e=a.getSymbolRecord(),
"variable"===e.keyword)))return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:c,source:d,target:e.name}),!0;break;case "delete":d=a.nextToken();if(["property","element"].includes(d)&&(e=a.getNextValue(),["from","of"].includes(a.getToken())&&a.nextIsSymbol())){var f=a.getSymbolRecord();if("variable"===f.keyword)return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:c,what:d,value:e,target:f.name}),!0}break;case "rename":d=a.getNextValue();if(a.tokenIs("to")&&
(e=a.getNextValue(),a.tokenIs("in")&&a.nextIsSymbol()&&(f=a.getSymbolRecord(),"variable"===f.keyword)))return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:c,oldName:d,newName:e,target:f.name}),!0;break;case "add":d=a.getNextValue();if(a.tokenIs("to")&&a.nextIsSymbol()&&(e=a.getSymbolRecord(),"variable"===e.keyword))return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:c,item:d,target:e.name}),!0;break;case "split":d=a.getNextValue();e="\n";a.tokenIs("on")&&
(e=a.getNextValue());if(["giving","into"].includes(a.getToken())&&a.nextIsSymbol()&&(f=a.getSymbolRecord(),"variable"===f.keyword))return a.next(),a.addCommand({domain:"json",keyword:"json",lino:b,request:c,item:d,on:e,target:f.name}),!0;break;case "replace":if(a.nextTokenIs("element")&&(d=a.getNextValue(),a.tokenIs("of")&&a.nextIsSymbol()&&(e=a.getSymbolRecord(),"variable"===e.keyword&&["by","with"].includes(a.nextToken()))))return f=a.getNextValue(),a.addCommand({domain:"json",keyword:"json",lino:b,
request:c,target:e.name,index:d,value:f}),!0}a.addWarning("Unrecognised json command syntax");return!1},run:function(a){var b=a[a.pc];switch(b.request){case "setVariable":var c=a.getSymbolRecord(b.target);var d="array"===b.type?"[]":"{}";c.value[c.index]={type:"constant",numeric:!1,content:d};break;case "setList":c=a.getSymbolRecord(b.source);c=a.getValue(c.value[c.index]);var e="";try{e=JSON.parse(c)}catch(l){return a.runtimeError(b.lino,"Can't parse JSON"),0}c=a.getSymbolRecord(b.target);var f=
c.element[c.index];f.options.length=0;var g=a.getValue(b.display);e.forEach(function(l){var n=g?a.decode(l[g]):null,r=document.createElement("option");r.innerHTML=n?n:l;l=n?JSON.stringify(l):l;r.value=l;f.appendChild(r)});f.selectedIndex=-1;break;case "sort":c=a.getSymbolRecord(b.target);d=(e=a.getValue(c.value[c.index]))?JSON.stringify(JSON.parse(e).sort()):null;c.value[c.index]={type:"constant",numeric:!1,content:d};break;case "shuffle":c=a.getSymbolRecord(b.target);e=JSON.parse(a.getValue(c.value[c.index]));
for(d=e.length-1;0<d;d--){var h=Math.floor(Math.random()*(d+1)),k=$jscomp.makeIterator([e[h],e[d]]);e[d]=k.next().value;e[h]=k.next().value}c.value[c.index]={type:"constant",numeric:!1,content:JSON.stringify(e)};break;case "format":c=a.getSymbolRecord(b.target);e=JSON.parse(a.getValue(c.value[c.index]));c.value[c.index]={type:"constant",numeric:!1,content:JSON.stringify(e,null,2)};break;case "parse":e=a.getValue(b.source);c=a.getSymbolRecord(b.target);d={url:e};h=e.indexOf("://");0<=h&&(h+=3,d.protocol=
e.substr(0,h),e=e.substr(h));h=e.indexOf("?");0<h?(d.domain=e.substr(0,h),d.arg=e.substr(h+1)):d.domain=e;d.domain.endsWith("/")&&(d.domain=d.domain.slice(0,-1));h=d.domain.indexOf("/");0<h?(d.path=d.domain.substr(h+1),d.domain=d.domain.substr(0,h)):d.path="";c.value[c.index]={type:"constant",numeric:!1,content:JSON.stringify(d,null,2)};break;case "delete":switch(b.what){case "property":d=a.getValue(b.value);c=a.getSymbolRecord(b.target);e=JSON.parse(c.value[c.index].content);delete e[d];c.value[c.index].content=
JSON.stringify(e);break;case "element":d=a.getValue(b.value),c=a.getSymbolRecord(b.target),e=JSON.parse(c.value[c.index].content),e.splice(d,1),c.value[c.index].content=JSON.stringify(e)}break;case "rename":h=a.getValue(b.oldName);k=a.getValue(b.newName);c=a.getSymbolRecord(b.target);e=JSON.parse(c.value[c.index].content);d=e[h];delete e[h];e[k]=d;c.value[c.index].content=JSON.stringify(e);break;case "add":d=a.getValue(b.item);c=a.getSymbolRecord(b.target);e=(e=c.value[c.index].content)?JSON.parse(e):
[];e.push(a.isJsonString(d)?JSON.parse(d):d);c.value[c.index]={type:"constant",numeric:!1,content:JSON.stringify(e)};break;case "split":d=a.getValue(b.item);e=a.getValue(b.on);c=a.getSymbolRecord(b.target);c.value[c.index]={type:"constant",numeric:!1,content:JSON.stringify(d.split(e))};break;case "replace":c=a.getSymbolRecord(b.target),d=a.getValue(b.index),h=a.getValue(b.value),e=(e=c.value[c.index].content)?JSON.parse(e):[],d>e.length-1&&a.runtimeError(b.lino,"Index out of range"),e[d]=h,c.value[c.index].content=
JSON.stringify(e)}return b.pc+1}},getHandler:function(a){switch(a){case "json":return EasyCoder_Json.Json;default:return null}},run:function(a){var b=a[a.pc],c=EasyCoder_Json.getHandler(b.keyword);c||a.runtimeError(b.lino,"Unknown keyword '"+b.keyword+"' in 'json' package");return c.run(a)},value:{compile:function(a){a.tokenIs("the")&&a.next();if(a.tokenIs("json")){var b=a.nextToken();if(["size","count"].includes(b)){if(a.skip("of"),a.isSymbol()){var c=a.getSymbolRecord();a.next();if(c.isVHolder)return{domain:"json",
type:b,name:c.name}}}else if("keys"===b){if(c=!0,a.nextTokenIs("unsorted")&&(c=!1,a.next()),a.tokenIs("of")&&a.nextIsSymbol()){var d=a.getSymbolRecord();a.next();if(d.isVHolder)return{domain:"json",type:b,name:d.name,sorted:c}}}else if("index"===b&&a.nextTokenIs("of")&&(c=a.getNextValue(),a.tokenIs("in")))return a=a.getNextValue(),{domain:"json",type:b,item:c,list:a}}return null},get:function(a,b){switch(b.type){case "size":case "count":var c=a.getSymbolRecord(b.name);a=a.getValue(c.value[c.index]);
try{var d=JSON.parse(a)}catch(f){d=[]}return{type:"constant",numeric:!0,content:d?d.length:0};case "keys":return c=a.getSymbolRecord(b.name),d=(a=a.getValue(c.value[c.index]))?JSON.stringify(Object.keys(JSON.parse(a)).sort()):"[]",a?(d=Object.keys(JSON.parse(a)),b.sorted&&(d=d.sort()),d=JSON.stringify(d)):d="[]",{type:"constant",numeric:!1,content:d};case "index":var e=a.getValue(b.item);d=JSON.parse(a.getValue(b.list)).findIndex(function(f){return f===e});return{type:"constant",numeric:!0,content:d}}}},
condition:{compile:function(){},test:function(){}}},EasyCoder_Rest={name:"EasyCoder_Rest",Rest:{compile:function(a){var b=a.getLino();switch(a.nextToken()){case "path":var c=a.getNextValue();a.addCommand({domain:"rest",keyword:"rest",lino:b,request:"path",path:c});return!0;case "get":if(a.nextIsSymbol(!0)&&(c=a.getSymbolRecord(),"variable"===c.keyword&&a.nextTokenIs("from"))){var d=a.getNextValue(),e=a.getPc();a.addCommand({domain:"rest",keyword:"rest",lino:b,request:"get",target:c.name,url:d,onError:null});
a.tokenIs("or")&&(a.next(),a.getCommandAt(e).onError=a.getPc()+1,a.completeHandler());return!0}break;case "post":c=null;if(a.nextTokenIs("to"))a.next();else if(c=a.getValue(),a.tokenIs("to"))a.next();else break;d=a.getValue();if(!d)throw Error(command.lino,"No URL present");e=null;if(a.tokenIs("giving")&&a.nextIsSymbol())if(e=a.getSymbolRecord(),e.isVHolder)e=e.name,a.next();else throw Error("'"+e.name+"' cannot hold a value");a.addCommand({domain:"rest",keyword:"rest",lino:b,request:"post",value:c,
url:d,target:e,onError:a.getPc()+2});onError=null;a.tokenIs("or")&&(a.next(),a.completeHandler());return!0}return!1},createCORSRequest:function(a,b){var c=new XMLHttpRequest;"withCredentials"in c?c.open(a,b,!0):"undefined"!=typeof XDomainRequest?(c=new XDomainRequest,c.open(a,b)):c=null;return c},run:function(a){var b=a[a.pc];if("path"==b.request)return EasyCoder_Rest.restPath=a.getValue(b.path),b.pc+1;var c=a.getValue(b.url);EasyCoder_Rest.restPath||(EasyCoder_Rest.restPath="/wp-content/plugins/easycoder/rest.php");
var d=c;c.startsWith("http")||(d="/"==c[0]?c.substr(1):EasyCoder_Rest.restPath+"/"+c);var e=EasyCoder_Rest.Rest.createCORSRequest(b.request,d);if(e){e.script=a.script;e.pc=a.pc;e.onload=function(){var f=EasyCoder.scripts[e.script],g=f[e.pc];if(200<=e.status&&400>e.status){var h=e.responseText.trim();if(g.target){var k=a.getSymbolRecord(b.target);k.value[k.index]={type:"constant",numeric:!1,content:h};k.used=!0}f.run(g.pc+1)}else h=e.status+" "+e.statusText,g.onError?(f.errorMessage="Exception trapped: "+
h,f.run(g.onError)):f.runtimeError(g.lino,"Error: "+h)};e.onerror=function(){b.onError?(a.errorMessage=this.responseText,a.run(b.onError)):a.runtimeError(b.lino,this.responseText)};switch(b.request){case "get":e.send();break;case "post":c=a.getValue(b.value),console.log("POST to "+d),e.setRequestHeader("Content-type","application/json; charset=UTF-8"),e.send(c)}return 0}a.runtimeError(b.lino,"CORS not supported")}},getHandler:function(a){switch(a){case "rest":return EasyCoder_Rest.Rest;default:return null}},
run:function(a){var b=a[a.pc],c=EasyCoder_Rest.getHandler(b.keyword);c||a.runtimeError(b.lino,"Unknown keyword '"+b.keyword+"' in 'rest' package");return c.run(a)},value:{compile:function(){return null},get:function(){return null}},condition:{compile:function(){},test:function(){}}},EasyCoder_Compare=function(a,b,c){b=a.value.evaluate(a,b);a=a.value.evaluate(a,c);c=b.content;var d=a.content;c&&b.numeric?a.numeric||(d=""===d||"-"===d||"undefined"===typeof d?0:parseInt(d)):(d&&a.numeric&&(d=d.toString()),
"undefined"===typeof c&&(c=""),"undefined"===typeof d&&(d=""));return c>d?1:c<d?-1:0},EasyCoder_Condition={name:"EasyCoder_Condition",compile:function(a){a.mark();for(var b=$jscomp.makeIterator(Object.keys(a.domain)),c=b.next();!c.done;c=b.next()){if(c=a.domain[c.value].condition.compile(a))return c;a.rewind()}},test:function(a,b){return a.domain[b.domain].condition.test(a,b)}},EasyCoder_Value={name:"EasyCoder_Value",getItem:function(a){var b=a.getToken();if(!b)return null;if("true"===b)return a.next(),
{type:"boolean",content:!0};if("false"===b)return a.next(),{type:"boolean",content:!1};if("`"===b.charAt(0))return a.next(),{type:"constant",numeric:!1,content:b.substring(1,b.length-1)};if(b.charAt(0).match(/[0-9-]/)){var c=eval(b);if(Number.isInteger(c))return a.next(),{type:"constant",numeric:!0,content:c};throw Error("'"+b+"' is not an integer");}b=a.getIndex();c=$jscomp.makeIterator(Object.keys(a.domain));for(var d=c.next();!d.done;d=c.next())if(d=d.value,a.rewindTo(b),d=a.domain[d].value.compile(a))return d;
return null},compile:function(a){var b=a.getToken(),c=EasyCoder_Value.getItem(a);if(!c)throw Error("Undefined value: '"+b+"'");if("cat"===a.getToken()){for(var d={type:"cat",numeric:!1,parts:[c]};a.tokenIs("cat");){a.next();c=EasyCoder_Value.getItem(a);if(!c)throw Error("Undefined value: '"+b+"'");d.parts.push(c)}return d}return c},doValue:function(a,b){if("undefined"===typeof b.type)return a.runtimeError(a[a.pc].lino,"Undefined value (variable not initialized?)"),null;switch(b.type){case "cat":return{type:"constant",
numeric:!1,content:b.parts.reduce(function(d,e){e=EasyCoder_Value.doValue(a,e);return d+(e?e.content:"")},"")};case "boolean":case "constant":return b;case "symbol":var c=a.getSymbolRecord(b.name);if(c.isVHolder){if(b=c.value[c.index]){c=b.content;if(null===c||"undefined"===typeof c)b.content=b.numeric?0:"";return b}return null}return a.domain[c.domain].value.get(a,b)}return a.domain[b.domain].value.get(a,b)},constant:function(a,b){return{type:"constant",numeric:b,content:a}},evaluate:function(a,
b){if(!b)return{type:"constant",numeric:!1,content:""};var c=EasyCoder_Value.doValue(a,b);if(c)return c;a.runtimeError(a[a.pc].lino,"Can't decode value: "+b)},getValue:function(a,b){return(a=EasyCoder_Value.evaluate(a,b))?a.content:null},encode:function(a,b){if(a)switch(b){default:case "ec":return a.replace(/\n/g,"~lf~").replace(/%0a/g,"~lf~").replace(/\n/g,"~cr~").replace(/%0d/g,"~cr~").replace(/"/g,"~dq~").replace(/'/g,"~sq~").replace(/\\/g,"~bs~");case "url":return encodeURIComponent(a.replace(/\s/g,
"+"));case "base64":return btoa(a);case "sanitize":return a.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}return a},decode:function(a,b){if(a)switch(b){default:case "ec":return a.replace(/%0a/g,"\n").replace(/~lf~/g,"\n").replace(/%0d/g,"\r").replace(/~cr~/g,"\n").replace(/~dq~/g,'"').replace(/~sq~/g,"'").replace(/~bs~/g,"\\");case "url":return decodeURIComponent(a).replace(/\+/g," ");case "base64":return atob(a)}return a}},EasyCoder_Run={name:"EasyCoder_Run",run:function(a,b){var c=[],d=function(q){var t=
9999;q.forEach(function(u){u=u.line;for(var p=0;p<u.length&&" "===u[p];)p++;0<p&&p<t&&(t=p)});return 0};if(c.length)c.push(b);else for(a.register(a),c.push(b);0<c.length;)for(a.pc=c.shift(),a.watchdog=0,b={};a.running;){if(1E6<a.watchdog){a.lino=a[a.pc].lino;a.reportError(Error("Program runaway intercepted.\nHave you forgotten to increment a loop counter?",a),a);break}a.watchdog++;var e=a[a.pc].domain;a.debugStep&&console.log(a.script+": Line "+a[a.pc].lino+": PC: "+a.pc+" "+e+":"+a[a.pc].keyword);
var f=a.domain[e];if(!f){a.runtimeError(a[a.pc].lino,"Unknown domain '"+e+"'");break}a.pc=f.run(a);if(!a.pc)break;if(a.stop){a.tracing=!1;break}if(a.tracing){e=a[a.pc];f=a.source.scriptLines;var g=d(f),h=document.getElementById("easycoder-tracer");if(!h){a.runtimeError(e.lino,"Element 'easycoder-tracer' was not found");return}h.style.display="block";h.style.visibility="visible";var k="";if(a.tracer){if(h=document.getElementById("easycoder-tracer-content")){a.tracer.variables.forEach(function(q,t,
u){var p=a.getSymbolRecord(q);if(1<p.elements)for(k+=q+": "+p.index+"/"+p.elements+": ",q=0;q<p.elements;q++){var v=p.value[q];k=v?k+(v.content+" "):k+"undefined "}else k=(p=p.value[p.index])?k+(q+": "+p.content):k+(q+": undefined");switch(a.tracer.alignment){case "horizontal":t<u.length-1&&(k+=", ");break;case "vertical":k+="<br>"}});k+="<hr>";for(var l="",n=5;0<n;n--){if(e.lino){var r=f[e.lino-n].line.substr(g);l+='<input type="text" name="'+n+'"value="'+(e.lino-n+1+": "+r.split("\\s").join(" ")+
'"style="width:100%;border:none;enabled:false">')}l+="<br>"}h.innerHTML=k+" "+l;h.style.display="block";b.$jscomp$loop$prop$run$144=document.getElementById("easycoder-run-button");b.$jscomp$loop$prop$step$145=document.getElementById("easycoder-step-button");b.$jscomp$loop$prop$run$144.onclick=function(q){return function(){q.$jscomp$loop$prop$run$144.blur();a.tracing=!1;document.getElementById("easycoder-tracer-content").style.display="none";try{EasyCoder_Run.run(a,a.resume)}catch(u){var t="Error in run handler: "+
u.message;console.log(t);alert(t)}}}(b);b.$jscomp$loop$prop$step$145.onclick=function(q){return function(){console.log("step");q.$jscomp$loop$prop$step$145.blur();a.tracing=!0;document.getElementById("easycoder-tracer-content").style.display="block";try{a.run(a.resume)}catch(u){var t="Error in step handler: "+u.message;console.log(t);alert(t)}}}(b)}a.resume=a.pc;a.pc=0}break}b={$jscomp$loop$prop$run$144:b.$jscomp$loop$prop$run$144,$jscomp$loop$prop$step$145:b.$jscomp$loop$prop$step$145}}},exit:function(a){a.onExit&&
a.run(a.onExit);var b=a.parent,c=a.afterExit;delete EasyCoder.scripts[a.script];a.module&&delete a.module.program;Object.keys(a).forEach(function(d){delete a[d]});b&&c&&EasyCoder.scripts[b].run(c)}},EasyCoder_Compiler={name:"EasyCoder_Compiler",getTokens:function(){return this.tokens},addWarning:function(a){this.warnings.push(a)},warning:function(a){this.addWarning(a)},unrecognisedSymbol:function(a){this.addWarning("Unrecognised symbol '"+a+"'")},getWarnings:function(){return this.warnings},getIndex:function(){return this.index},
next:function(a){this.index+=void 0===a?1:a},peek:function(){return this.tokens[this.index+1].token},more:function(){return this.index<this.tokens.length},getToken:function(){return this.index>=this.tokens.length?null:this.tokens[this.index]?this.tokens[this.index].token:null},nextToken:function(){this.next();return this.getToken()},tokenIs:function(a){return this.index>=this.tokens.length?!1:a===this.tokens[this.index].token},nextTokenIs:function(a){this.next();return this.tokenIs(a)},skip:function(a){if(this.index>=
this.tokens.length)return null;this.next();this.tokenIs(a)&&this.next()},prev:function(){this.index--},getLino:function(){return this.index>=this.tokens.length?0:this.tokens[this.index].lino},getTarget:function(a){a=void 0===a?this.index:a;return this.tokens[a].token},getTargetPc:function(a){a=void 0===a?this.index:a;return this.symbols[this.getTarget(a)].pc},getCommandAt:function(a){return this.program[a]},isSymbol:function(a){a=void 0===a?!1:a;if(this.getTarget()in this.symbols)return!0;if(a)throw Error("Unknown symbol: '"+
this.getTarget()+"'");return!1},nextIsSymbol:function(a){a=void 0===a?!1:a;this.next();return this.isSymbol(a)},getSymbol:function(a){if(this.isSymbol(void 0===a?!1:a))return this.symbols[this.getToken()]},getSymbolPc:function(a){return this.getSymbol(void 0===a?!1:a).pc},getSymbolRecord:function(){var a=this.program[this.getSymbolPc(!0)];a.used=!0;return a},getSymbols:function(){return this.symbols},getProgram:function(){return this.program},getPc:function(){return this.program.length},getValue:function(){return this.value.compile(this)},
getNextValue:function(){this.next();return this.getValue()},getCondition:function(){return this.condition.compile(this)},constant:function(a,b){return this.value.constant(a,void 0===b?!1:b)},addCommand:function(a){a.pc=this.program.length;this.program.push(a)},addSymbol:function(a,b){this.symbols[a]={pc:b}},mark:function(){this.savedMark=this.index},rewind:function(){this.index=this.savedMark},rewindTo:function(a){this.index=a},completeHandler:function(){var a=this.getLino(),b=this.getPc();this.addCommand({domain:"core",
keyword:"goto",lino:a,goto:0});this.compileOne();this.continue?(this.addCommand({domain:"core",keyword:"goto",lino:a,goto:this.getPc()+1}),this.continue=!1):this.addCommand({domain:"core",keyword:"stop",lino:a,next:0});this.getCommandAt(b).goto=this.getPc();return!0},compileVariable:function(a,b,c,d){c=void 0===c?!1:c;d=void 0===d?null:d;this.next();var e=this.getLino(),f=this.getTokens()[this.getIndex()];if(this.symbols[f.token])throw Error("Duplicate variable name '"+f.token+"'");var g=this.getPc();
this.next();this.addSymbol(f.token,g);a={domain:a,keyword:b,lino:e,isSymbol:!0,used:!1,isVHolder:c,name:f.token,elements:1,index:0,value:[{}],element:[],extra:d};"dom"===d&&(a.element=[]);this.addCommand(a);return a},compileToken:function(){var a=this.getToken();if(a){this.mark();for(var b=$jscomp.makeIterator(Object.keys(this.domain)),c=b.next();!c.done;c=b.next()){if((c=this.domain[c.value])&&(c=c.getHandler(a))&&c.compile(this))return;this.rewind()}console.log("No handler found");throw Error("I don't understand '"+
a+"...'");}},compileOne:function(){var a=this.getToken();if(a){this.warnings=[];var b=this.program.length;if(a.endsWith(":")){a=a.substring(0,a.length-1);if(this.symbols[a])throw Error("Duplicate symbol: '"+a+"'");this.symbols[a]={pc:b};this.index++}else this.compileToken()}},compileFromHere:function(a){for(;this.index<this.tokens.length;){var b=this.tokens[this.index].token;if("else"===b)return this.program;this.compileOne();if(-1<a.indexOf(b))break}},compile:function(a){this.tokens=a;this.index=
0;this.program=[];this.program.script=0;this.program.symbols={};this.symbols=this.program.symbols;this.warnings=[];this.compileFromHere([]);this.addCommand({domain:"core",keyword:"exit",lino:this.getLino(),next:0});for(var b in this.symbols)a=this.program[this.symbols[b].pc],!a.isSymbol||a.used||a.exporter||console.log("Symbol '"+a.name+"' has not been used.");return this.program}},EasyCoder={name:"EasyCoder_Main",domain:{core:EasyCoder_Core,browser:EasyCoder_Browser,json:EasyCoder_Json,rest:EasyCoder_Rest},
elementId:0,runtimeError:function(a,b){this.lino=a;this.reportError({message:"Line "+(0<=a?a:"")+": "+b},this.program);this.program&&(this.program.aborted=!0)},nonNumericValueError:function(a){this.runtimeError(a,"Non-numeric value")},variableDoesNotHoldAValueError:function(a,b){this.runtimeError(a,"Variable '"+b+"' does not hold a value")},reportError:function(a,b,c){if(a.message)if(this.compiling||b){c=c?c:b.source;var d=c.tokens;c=c.scriptLines;var e=EasyCoder_Compiler;d=this.compiling?d[e.getIndex()].lino:
b[b.pc].lino;b=this.compiling?"Compile error in '"+e.script+"'":"Runtime error in '"+b.script+"'";b+=":\n";var f=d-5;for(f=0>f?0:f;f<d;f++){var g=(""+(f+1)).padStart(4," ");b+=g+" "+c[f].line.split("\\s").join(" ")+"\n"}b+=a.message+"\n";a=e.getWarnings();if(a.length)for(b+="Warnings:\n",a=$jscomp.makeIterator(a),c=a.next();!c.done;c=a.next())b+=c.value+"\n";console.log(b);alert(b)}else a="Error: "+a.message,alert(a),console.log(a);else console.log("An error occurred - origin was "+a.path[0])},getSymbolRecord:function(a){a=
this[this.symbols[a].pc];return a.alias?this.getSymbolRecord(a.alias):a.exporter?EasyCoder.scripts[a.exporter].getSymbolRecord(a.exportedName):a},verifySymbol:function(a){return"undefined"!==typeof this.symbols[a]},encode:function(a){return EasyCoder_Value.encode(a,this.encoding)},decode:function(a){return EasyCoder_Value.decode(a,this.encoding)},evaluate:function(a){return EasyCoder_Value.evaluate(this,a)},getValue:function(a){return EasyCoder_Value.getValue(this,a)},getFormattedValue:function(a){a=
EasyCoder_Value.evaluate(this,a);if(a.numeric)return a.content;if("boolean"===a.type)return a.content?"true":"false";if(this.isJsonString(a.content))try{var b=JSON.parse(a.content);return JSON.stringify(b,null,2)}catch(c){return this.reportError(c),"{}"}return a.content},getSimpleValue:function(a){return!0===a||!1===a?{type:"boolean",content:a}:{type:"constant",numeric:Number.isInteger(a),content:a}},run:function(a){a&&(this.program=this,EasyCoder_Run.run(this,a))},exit:function(){EasyCoder_Run.exit(this)},
register:function(a){$jscomp$this.program=a},require:function(a,b,c){var d="";"/"==b[0]&&(d=window.location.origin+"/");var e=document.createElement("css"===a?"link":"script");switch(a){case "css":e.type="text/css";e.href=""+d+b;e.rel="stylesheet";break;case "js":e.type="text/javascript";e.src=""+d+b;break;default:return}e.onload=function(){console.log(Date.now()-EasyCoder.timestamp+" ms: Library "+d+b+" loaded");c()};document.head.appendChild(e)},isUndefined:function(a){return"undefined"===typeof a},
isJsonString:function(a){try{JSON.parse(a)}catch(b){return!1}return!0},runScript:function(a){var b=a[a.pc],c=a.getValue(b.script),d=b.imports;d.caller=a.script;var e=b.module?a.getSymbolRecord(b.module):null;try{EasyCoder.tokeniseAndCompile(c.split("\n"),d,e,this.script,b.then)}catch(f){EasyCoder.reportError(f,a,a.source);a.onError?a.run(a.onError):(a=EasyCoder.scripts[a.parent])&&a.onError&&a.run(a.onError);return}b.nowait&&EasyCoder.run(a.nextPc)},close:function(){},compileScript:function(a,b,c,
d){var e=a.tokens;this.compiling=!0;var f=EasyCoder_Compiler;this.compiler=f;f.value=EasyCoder_Value;f.condition=EasyCoder_Condition;f.parent=d;f.domain=this.domain;f.imports=b;f.continue=!1;b=f.compile(e);this.compiling=!1;b.EasyCoder=this;b.value=EasyCoder_Value;b.condition=EasyCoder_Condition;b.compare=EasyCoder_Compare;b.source=a;b.run=this.run;b.exit=this.exit;b.runScript=this.runScript;b.evaluate=this.evaluate;b.getValue=this.getValue;b.getFormattedValue=this.getFormattedValue;b.getSimpleValue=
this.getSimpleValue;b.encode=this.encode;b.decode=this.decode;b.domain=this.domain;b.require=this.require;b.isUndefined=this.isUndefined;b.isJsonString=this.isJsonString;b.getSymbolRecord=this.getSymbolRecord;b.verifySymbol=this.verifySymbol;b.runtimeError=this.runtimeError;b.nonNumericValueError=this.nonNumericValueError;b.variableDoesNotHoldAValueError=this.variableDoesNotHoldAValueError;b.reportError=this.reportError;b.register=this.register;b.symbols=f.getSymbols();b.unblocked=!1;b.encoding="ec";
b.popups=[];b.stack=[];b.queue=[0];b.module=c;b.parent=d;c&&(c.program=b.script);return b},tokeniseFile:function(a){var b=[],c=[],d=0;a.forEach(function(e,f){b.push({lino:f+1,line:e});for(var g=e.length,h="",k=!0,l=0;l<g;l++){var n=e[l];if(0==n.trim().length)k||(c.push({index:d,lino:f+1,token:h}),d++,h="",k=!0);else if(k=!1,"`"===n){for(m=l;++l<e.length&&"`"!==e[l];);h=e.substr(m,l-m+1)}else if("!"==n)break;else h+=n}0<h.length&&c.push({index:d,lino:f+1,token:h})});return{scriptLines:b,tokens:c}},
tokeniseAndCompile:function(a,b,c,d,e){var f=null,g=Date.now();a=this.tokeniseFile(a);try{f=this.compileScript(a,b,c,d);f.script||(f.script=EasyCoder.scriptIndex,EasyCoder.scriptIndex++);var h=Date.now();console.log(h-this.timestamp+" ms: Compiled "+(f.script+": "+a.scriptLines.length+" lines ("+a.tokens.length+" tokens) in ")+(h-g+" ms"))}catch(k){"stop"!==k.message&&(b=EasyCoder.scripts[d],this.reportError(k,b,a),b&&b.onError&&b.run(b.onError),EasyCoder_Compiler.script&&(delete EasyCoder.scripts[EasyCoder_Compiler.script],
delete EasyCoder_Compiler.script));return}f&&(EasyCoder.scripts[f.script]=f,c&&(c.program=f.script),f.afterExit=e,f.running=!0,EasyCoder_Run.run(f,0))},start:function(a){EasyCoder.restPath="rest.php";EasyCoder.scriptIndex=0;var b=a.split("\n");if(!this.tokenising){try{this.tokeniseAndCompile(b)}catch(c){this.reportError(c,null,a)}this.tokenising=!0}},version:"2.7.8"};EasyCoder.timestamp=Date.now();console.log("EasyCoder loaded; waiting for page");
function EasyCoder_Startup(){console.log(Date.now()-EasyCoder.timestamp+" ms: Page loaded; reset timer & start EasyCoder");EasyCoder.timestamp=Date.now();EasyCoder.scripts={};window.EasyCoder=EasyCoder;var a=document.getElementById("easycoder-script");if(a){a.style.display="none";try{EasyCoder.start(a.innerText)}catch(b){EasyCoder.reportError(b)}}}window.onload=EasyCoder_Startup;
